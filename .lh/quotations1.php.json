{
    "sourceFile": "quotations1.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 15,
            "patches": [
                {
                    "date": 1758459946506,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758460169475,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,18 +33,13 @@\n     FOREIGN KEY (quotation_id) REFERENCES quotations(id) ON DELETE CASCADE\r\n ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\";\r\n \r\n // รัน SQL\r\n-if ($conn->query($sql1) === TRUE) {\r\n-    echo \"ตาราง quotations ถูกสร้างเรียบร้อย<br>\";\r\n-} else {\r\n-    echo \"Error creating quotations: \" . $conn->error . \"<br>\";\r\n-}\r\n+$conn->query($sql1);\r\n+$conn->query($sql2);\r\n \r\n-if ($conn->query($sql2) === TRUE) {\r\n-    echo \"ตาราง quotation_items ถูกสร้างเรียบร้อย<br>\";\r\n-} else {\r\n-    echo \"Error creating quotation_items: \" . $conn->error . \"<br>\";\r\n-}\r\n+$conn->close();\r\n \r\n-$conn->close();\r\n+// ✅ เสร็จแล้วเด้งกลับไปหน้า index.html\r\n+header(\"Location: index.html\");\r\n+exit;\r\n ?>\r\n"
                },
                {
                    "date": 1758460291290,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,43 +1,62 @@\n <?php\r\n-$servername = \"localhost\";\r\n-$username = \"root\"; // เปลี่ยนตามจริง\r\n-$password = \"\";     // เปลี่ยนตามจริง\r\n+$host = \"localhost\";\r\n+$user = \"root\";\r\n+$pass = \"\";\r\n $dbname = \"shop_it\";\r\n \r\n-// สร้างการเชื่อมต่อ\r\n-$conn = new mysqli($servername, $username, $password, $dbname);\r\n-\r\n-// ตรวจสอบการเชื่อมต่อ\r\n+// เชื่อมต่อฐานข้อมูล\r\n+$conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n-    die(\"Connection failed: \" . $conn->connect_error);\r\n+    die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n }\r\n \r\n-// SQL สำหรับสร้างตาราง quotations\r\n-$sql1 = \"CREATE TABLE IF NOT EXISTS quotations (\r\n-    id INT(11) AUTO_INCREMENT PRIMARY KEY,\r\n-    quotation_no VARCHAR(50) NOT NULL,\r\n-    subject VARCHAR(255) NOT NULL,\r\n-    recipient_name VARCHAR(255) NOT NULL,\r\n-    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\";\r\n+// ตรวจสอบ method\r\n+if ($_SERVER['REQUEST_METHOD'] !== 'POST') {\r\n+    die(\"กรุณาส่งข้อมูลด้วย POST\");\r\n+}\r\n \r\n-// SQL สำหรับสร้างตาราง quotation_items\r\n-$sql2 = \"CREATE TABLE IF NOT EXISTS quotation_items (\r\n-    id INT(11) AUTO_INCREMENT PRIMARY KEY,\r\n-    quotation_id INT(11) NOT NULL,\r\n-    item_name VARCHAR(255) NOT NULL,\r\n-    qty INT(11) DEFAULT 0,\r\n-    price DECIMAL(10,2) DEFAULT 0.00,\r\n-    unit VARCHAR(50) DEFAULT NULL,\r\n-    total DECIMAL(10,2) DEFAULT 0.00,\r\n-    FOREIGN KEY (quotation_id) REFERENCES quotations(id) ON DELETE CASCADE\r\n-) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\";\r\n+// รับค่าจากฟอร์ม\r\n+$quotation_no   = $_POST['quotation_no']   ?? '';\r\n+$subject        = $_POST['subject']        ?? '';\r\n+$recipient_name = $_POST['recipient_name'] ?? '';\r\n \r\n-// รัน SQL\r\n-$conn->query($sql1);\r\n-$conn->query($sql2);\r\n+$item_names = $_POST['item_name'] ?? [];\r\n+$qtys       = $_POST['qty']       ?? [];\r\n+$prices     = $_POST['price']     ?? [];\r\n+$units      = $_POST['unit']      ?? [];\r\n+$totals     = $_POST['total']     ?? [];\r\n \r\n+// บันทึกใบเสนอราคา\r\n+$stmt = $conn->prepare(\"INSERT INTO quotations (quotation_no, subject, recipient_name) VALUES (?, ?, ?)\");\r\n+if (!$stmt) {\r\n+    die(\"Prepare failed: \" . $conn->error);\r\n+}\r\n+$stmt->bind_param(\"sss\", $quotation_no, $subject, $recipient_name);\r\n+$stmt->execute();\r\n+$quotation_id = $stmt->insert_id;\r\n+$stmt->close();\r\n+\r\n+// บันทึกรายการสินค้า\r\n+if (!empty($item_names)) {\r\n+    $stmt = $conn->prepare(\"INSERT INTO quotation_items (quotation_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n+    if (!$stmt) {\r\n+        die(\"Prepare failed: \" . $conn->error);\r\n+    }\r\n+\r\n+    for ($i = 0; $i < count($item_names); $i++) {\r\n+        $name  = $item_names[$i];\r\n+        $qty   = $qtys[$i]   ?? 0;\r\n+        $price = $prices[$i] ?? 0;\r\n+        $unit  = $units[$i]  ?? '';\r\n+        $total = $totals[$i] ?? 0;\r\n+\r\n+        $stmt->bind_param(\"isiddd\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n+        $stmt->execute();\r\n+    }\r\n+    $stmt->close();\r\n+}\r\n+\r\n $conn->close();\r\n \r\n // ✅ เสร็จแล้วเด้งกลับไปหน้า index.html\r\n header(\"Location: index.html\");\r\n"
                },
                {
                    "date": 1758460689690,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,8 +57,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-// ✅ เสร็จแล้วเด้งกลับไปหน้า index.html\r\n-header(\"Location: index.html\");\r\n-exit;\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758553020709,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,6 +57,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery2.php'>กรอกต่อ</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758553030635,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,6 +57,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery2.php'>กรอกต่อ</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='quotations1.php'>กรอกต่อ</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758553037969,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,6 +57,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='quotations1.php'>กรอกต่อ</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='quotations1.html'>กรอกต่อ</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758553510747,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,6 +57,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='quotations1.html'>กรอกต่อ</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='quotations1.html'>กรอกต่อ</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758635504933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,14 +44,15 @@\n     }\r\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n         $name  = $item_names[$i];\r\n-        $qty   = $qtys[$i]   ?? 0;\r\n-        $price = $prices[$i] ?? 0;\r\n+        $qty   = (int)($qtys[$i] ?? 0);\r\n+        $price = (float)($prices[$i] ?? 0);\r\n         $unit  = $units[$i]  ?? '';\r\n-        $total = $totals[$i] ?? 0;\r\n+        $total = (float)($totals[$i] ?? 0);\r\n \r\n-        $stmt->bind_param(\"isiddd\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n+        // i = int, s = string, d = double\r\n+        $stmt->bind_param(\"isidss\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n         $stmt->execute();\r\n     }\r\n     $stmt->close();\r\n }\r\n"
                },
                {
                    "date": 1758723004660,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,27 +25,59 @@\n $prices     = $_POST['price']     ?? [];\r\n $units      = $_POST['unit']      ?? [];\r\n $totals     = $_POST['total']     ?? [];\r\n \r\n+// ---------------------------\r\n+// อัพโหลดไฟล์ PDF\r\n+// ---------------------------\r\n+$pdf_file_path = null;\r\n+\r\n+if (!empty($_FILES['pdf_file']['name'])) {\r\n+    // ตรวจสอบว่ามีโฟลเดอร์ uploads/quotations หรือยัง ถ้าไม่มีให้สร้างใหม่\r\n+    if (!is_dir('uploads/quotations')) {\r\n+        mkdir('uploads/quotations', 0777, true);\r\n+    }\r\n+\r\n+    $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n+    $targetFilePath = 'uploads/quotations/' . $fileName;\r\n+\r\n+    $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n+\r\n+    // ตรวจสอบว่าเป็น PDF เท่านั้น\r\n+    if ($fileType === \"pdf\") {\r\n+        if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n+            $pdf_file_path = $targetFilePath;\r\n+        } else {\r\n+            die(\"ไม่สามารถอัพโหลดไฟล์ได้\");\r\n+        }\r\n+    } else {\r\n+        die(\"ไฟล์ต้องเป็น PDF เท่านั้น\");\r\n+    }\r\n+}\r\n+\r\n+// ---------------------------\r\n // บันทึกใบเสนอราคา\r\n-$stmt = $conn->prepare(\"INSERT INTO quotations (quotation_no, subject, recipient_name) VALUES (?, ?, ?)\");\r\n+// ---------------------------\r\n+$stmt = $conn->prepare(\"INSERT INTO quotations (quotation_no, subject, recipient_name, pdf_file) VALUES (?, ?, ?, ?)\");\r\n if (!$stmt) {\r\n     die(\"Prepare failed: \" . $conn->error);\r\n }\r\n-$stmt->bind_param(\"sss\", $quotation_no, $subject, $recipient_name);\r\n+$stmt->bind_param(\"ssss\", $quotation_no, $subject, $recipient_name, $pdf_file_path);\r\n $stmt->execute();\r\n $quotation_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n+// ---------------------------\r\n // บันทึกรายการสินค้า\r\n+// ---------------------------\r\n if (!empty($item_names)) {\r\n     $stmt = $conn->prepare(\"INSERT INTO quotation_items (quotation_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n     if (!$stmt) {\r\n         die(\"Prepare failed: \" . $conn->error);\r\n     }\r\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n-        $name  = $item_names[$i];\r\n+        $name  = $item_names[$i] ?? '';\r\n         $qty   = (int)($qtys[$i] ?? 0);\r\n         $price = (float)($prices[$i] ?? 0);\r\n         $unit  = $units[$i]  ?? '';\r\n         $total = (float)($totals[$i] ?? 0);\r\n"
                },
                {
                    "date": 1758724519369,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,63 @@\n+<?php\r\n+$host = \"localhost\";\r\n+$user = \"root\";\r\n+$pass = \"\";\r\n+$dbname = \"shop_it\";\r\n+\r\n+// เชื่อมต่อฐานข้อมูล\r\n+$conn = new mysqli($host, $user, $pass, $dbname);\r\n+if ($conn->connect_error) {\r\n+    die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n+}\r\n+\r\n+// ตรวจสอบ method\r\n+if ($_SERVER['REQUEST_METHOD'] !== 'POST') {\r\n+    die(\"กรุณาส่งข้อมูลด้วย POST\");\r\n+}\r\n+\r\n+// รับค่าจากฟอร์ม\r\n+$quotation_no   = $_POST['quotation_no']   ?? '';\r\n+$subject        = $_POST['subject']        ?? '';\r\n+$recipient_name = $_POST['recipient_name'] ?? '';\r\n+\r\n+$item_names = $_POST['item_name'] ?? [];\r\n+$qtys       = $_POST['qty']       ?? [];\r\n+$prices     = $_POST['price']     ?? [];\r\n+$units      = $_POST['unit']      ?? [];\r\n+$totals     = $_POST['total']     ?? [];\r\n+\r\n+// บันทึกใบเสนอราคา\r\n+$stmt = $conn->prepare(\"INSERT INTO quotations (quotation_no, subject, recipient_name) VALUES (?, ?, ?)\");\r\n+if (!$stmt) {\r\n+    die(\"Prepare failed: \" . $conn->error);\r\n+}\r\n+$stmt->bind_param(\"sss\", $quotation_no, $subject, $recipient_name);\r\n+$stmt->execute();\r\n+$quotation_id = $stmt->insert_id;\r\n+$stmt->close();\r\n+\r\n+// บันทึกรายการสินค้า\r\n+if (!empty($item_names)) {\r\n+    $stmt = $conn->prepare(\"INSERT INTO quotation_items (quotation_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n+    if (!$stmt) {\r\n+        die(\"Prepare failed: \" . $conn->error);\r\n+    }\r\n+\r\n+    for ($i = 0; $i < count($item_names); $i++) {\r\n+        $name  = $item_names[$i];\r\n+        $qty   = (int)($qtys[$i] ?? 0);\r\n+        $price = (float)($prices[$i] ?? 0);\r\n+        $unit  = $units[$i]  ?? '';\r\n+        $total = (float)($totals[$i] ?? 0);\r\n+\r\n+        // i = int, s = string, d = double\r\n+        $stmt->bind_param(\"isidss\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n+        $stmt->execute();\r\n+    }\r\n+    $stmt->close();\r\n+}\r\n+\r\n+$conn->close();\r\n+\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='quotations1.html'>กรอกต่อ</a>\";\r\n+?>\r\n"
                },
                {
                    "date": 1758724613437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,78 +25,15 @@\n $prices     = $_POST['price']     ?? [];\r\n $units      = $_POST['unit']      ?? [];\r\n $totals     = $_POST['total']     ?? [];\r\n \r\n-// บันทึกใบเสนอราคา\r\n-$stmt = $conn->prepare(\"INSERT INTO quotations (quotation_no, subject, recipient_name) VALUES (?, ?, ?)\");\r\n-if (!$stmt) {\r\n-    die(\"Prepare failed: \" . $conn->error);\r\n-}\r\n-$stmt->bind_param(\"sss\", $quotation_no, $subject, $recipient_name);\r\n-$stmt->execute();\r\n-$quotation_id = $stmt->insert_id;\r\n-$stmt->close();\r\n-\r\n-// บันทึกรายการสินค้า\r\n-if (!empty($item_names)) {\r\n-    $stmt = $conn->prepare(\"INSERT INTO quotation_items (quotation_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n-    if (!$stmt) {\r\n-        die(\"Prepare failed: \" . $conn->error);\r\n-    }\r\n-\r\n-    for ($i = 0; $i < count($item_names); $i++) {\r\n-        $name  = $item_names[$i];\r\n-        $qty   = (int)($qtys[$i] ?? 0);\r\n-        $price = (float)($prices[$i] ?? 0);\r\n-        $unit  = $units[$i]  ?? '';\r\n-        $total = (float)($totals[$i] ?? 0);\r\n-\r\n-        // i = int, s = string, d = double\r\n-        $stmt->bind_param(\"isidss\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n-        $stmt->execute();\r\n-    }\r\n-    $stmt->close();\r\n-}\r\n-\r\n-$conn->close();\r\n-\r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='quotations1.html'>กรอกต่อ</a>\";\r\n-?>\r\n-<?php\r\n-$host = \"localhost\";\r\n-$user = \"root\";\r\n-$pass = \"\";\r\n-$dbname = \"shop_it\";\r\n-\r\n-// เชื่อมต่อฐานข้อมูล\r\n-$conn = new mysqli($host, $user, $pass, $dbname);\r\n-if ($conn->connect_error) {\r\n-    die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n-}\r\n-\r\n-// ตรวจสอบ method\r\n-if ($_SERVER['REQUEST_METHOD'] !== 'POST') {\r\n-    die(\"กรุณาส่งข้อมูลด้วย POST\");\r\n-}\r\n-\r\n-// รับค่าจากฟอร์ม\r\n-$quotation_no   = $_POST['quotation_no']   ?? '';\r\n-$subject        = $_POST['subject']        ?? '';\r\n-$recipient_name = $_POST['recipient_name'] ?? '';\r\n-\r\n-$item_names = $_POST['item_name'] ?? [];\r\n-$qtys       = $_POST['qty']       ?? [];\r\n-$prices     = $_POST['price']     ?? [];\r\n-$units      = $_POST['unit']      ?? [];\r\n-$totals     = $_POST['total']     ?? [];\r\n-\r\n // ---------------------------\r\n // อัพโหลดไฟล์ PDF\r\n // ---------------------------\r\n $pdf_file_path = null;\r\n \r\n if (!empty($_FILES['pdf_file']['name'])) {\r\n-    // ตรวจสอบว่ามีโฟลเดอร์ uploads/quotations หรือยัง ถ้าไม่มีให้สร้างใหม่\r\n+    // ตรวจสอบว่ามีโฟลเดอร์ uploads/quotations หรือยัง ถ้าไม่มีสร้างใหม่\r\n     if (!is_dir('uploads/quotations')) {\r\n         mkdir('uploads/quotations', 0777, true);\r\n     }\r\n \r\n@@ -104,12 +41,12 @@\n     $targetFilePath = 'uploads/quotations/' . $fileName;\r\n \r\n     $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n \r\n-    // ตรวจสอบว่าเป็น PDF เท่านั้น\r\n+    // ตรวจสอบว่าเป็น PDF\r\n     if ($fileType === \"pdf\") {\r\n         if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n-            $pdf_file_path = $targetFilePath;\r\n+            $pdf_file_path = $targetFilePath; // เก็บ path ลงฐานข้อมูล\r\n         } else {\r\n             die(\"ไม่สามารถอัพโหลดไฟล์ได้\");\r\n         }\r\n     } else {\r\n@@ -138,15 +75,14 @@\n         die(\"Prepare failed: \" . $conn->error);\r\n     }\r\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n-        $name  = $item_names[$i] ?? '';\r\n+        $name  = $item_names[$i];\r\n         $qty   = (int)($qtys[$i] ?? 0);\r\n         $price = (float)($prices[$i] ?? 0);\r\n         $unit  = $units[$i]  ?? '';\r\n         $total = (float)($totals[$i] ?? 0);\r\n \r\n-        // i = int, s = string, d = double\r\n         $stmt->bind_param(\"isidss\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n         $stmt->execute();\r\n     }\r\n     $stmt->close();\r\n"
                },
                {
                    "date": 1758725688443,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+$dbname = \"shop_it2\";\r\n \r\n // เชื่อมต่อฐานข้อมูล\r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n"
                },
                {
                    "date": 1758725814558,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it2\";\r\n+$dbname = \"shop_it\";\r\n \r\n // เชื่อมต่อฐานข้อมูล\r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n"
                },
                {
                    "date": 1758728009031,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+$dbname = \"shop_it2\";\r\n \r\n // เชื่อมต่อฐานข้อมูล\r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n@@ -75,13 +75,13 @@\n         die(\"Prepare failed: \" . $conn->error);\r\n     }\r\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n-        $name  = $item_names[$i];\r\n+        $name  = $item_names[$i] ?? '';\r\n         $qty   = (int)($qtys[$i] ?? 0);\r\n-        $price = (float)($prices[$i] ?? 0);\r\n+        $price = (float)($prices[$i] ?? 0.00);\r\n         $unit  = $units[$i]  ?? '';\r\n-        $total = (float)($totals[$i] ?? 0);\r\n+        $total = (float)($totals[$i] ?? 0.00);\r\n \r\n         $stmt->bind_param(\"isidss\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n         $stmt->execute();\r\n     }\r\n"
                },
                {
                    "date": 1758733772838,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,45 +1,46 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it2\";\r\n+$dbname = \"shop_it\";\r\n \r\n // เชื่อมต่อฐานข้อมูล\r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n     die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n }\r\n \r\n-// ตรวจสอบ method\r\n+// ตรวจสอบว่ามีการส่ง POST หรือไม่\r\n if ($_SERVER['REQUEST_METHOD'] !== 'POST') {\r\n     die(\"กรุณาส่งข้อมูลด้วย POST\");\r\n }\r\n \r\n-// รับค่าจากฟอร์ม\r\n-$quotation_no   = $_POST['quotation_no']   ?? '';\r\n-$subject        = $_POST['subject']        ?? '';\r\n-$recipient_name = $_POST['recipient_name'] ?? '';\r\n+// รับข้อมูลจากฟอร์ม (ตั้งค่า default ป้องกัน Warning)\r\n+$order_no = $_POST['order_no'] ?? '';\r\n+$customer_name = $_POST['customer_name'] ?? '';\r\n+$customer_address = $_POST['customer_address'] ?? '';\r\n+$grand_total = $_POST['grand_total'] ?? 0;\r\n \r\n $item_names = $_POST['item_name'] ?? [];\r\n-$qtys       = $_POST['qty']       ?? [];\r\n-$prices     = $_POST['price']     ?? [];\r\n-$units      = $_POST['unit']      ?? [];\r\n-$totals     = $_POST['total']     ?? [];\r\n+$qtys = $_POST['qty'] ?? [];\r\n+$prices = $_POST['price'] ?? [];\r\n+$units = $_POST['unit'] ?? [];\r\n+$totals = $_POST['total'] ?? [];\r\n \r\n // ---------------------------\r\n // อัพโหลดไฟล์ PDF\r\n // ---------------------------\r\n $pdf_file_path = null;\r\n \r\n if (!empty($_FILES['pdf_file']['name'])) {\r\n-    // ตรวจสอบว่ามีโฟลเดอร์ uploads/quotations หรือยัง ถ้าไม่มีสร้างใหม่\r\n-    if (!is_dir('uploads/quotations')) {\r\n-        mkdir('uploads/quotations', 0777, true);\r\n+    // ตรวจสอบว่ามีโฟลเดอร์ uploads/receipts หรือยัง ถ้าไม่มีสร้างใหม่\r\n+    if (!is_dir('uploads/receipts')) {\r\n+        mkdir('uploads/receipts', 0777, true);\r\n     }\r\n \r\n     $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n-    $targetFilePath = 'uploads/quotations/' . $fileName;\r\n+    $targetFilePath = 'uploads/receipts/' . $fileName;\r\n \r\n     $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n \r\n     // ตรวจสอบว่าเป็น PDF\r\n@@ -54,41 +55,41 @@\n     }\r\n }\r\n \r\n // ---------------------------\r\n-// บันทึกใบเสนอราคา\r\n+// บันทึกใบเสร็จ\r\n // ---------------------------\r\n-$stmt = $conn->prepare(\"INSERT INTO quotations (quotation_no, subject, recipient_name, pdf_file) VALUES (?, ?, ?, ?)\");\r\n+$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total, pdf_file) VALUES (?, ?, ?, ?, ?)\");\r\n if (!$stmt) {\r\n     die(\"Prepare failed: \" . $conn->error);\r\n }\r\n-$stmt->bind_param(\"ssss\", $quotation_no, $subject, $recipient_name, $pdf_file_path);\r\n+$stmt->bind_param(\"ssdds\", $order_no, $customer_name, $customer_address, $grand_total, $pdf_file_path);\r\n $stmt->execute();\r\n-$quotation_id = $stmt->insert_id;\r\n+$receipt_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // ---------------------------\r\n-// บันทึกรายการสินค้า\r\n+// บันทึกรายละเอียดสินค้า\r\n // ---------------------------\r\n if (!empty($item_names)) {\r\n-    $stmt = $conn->prepare(\"INSERT INTO quotation_items (quotation_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n+    $stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n     if (!$stmt) {\r\n         die(\"Prepare failed: \" . $conn->error);\r\n     }\r\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n         $name  = $item_names[$i] ?? '';\r\n         $qty   = (int)($qtys[$i] ?? 0);\r\n-        $price = (float)($prices[$i] ?? 0.00);\r\n-        $unit  = $units[$i]  ?? '';\r\n-        $total = (float)($totals[$i] ?? 0.00);\r\n+        $unit  = $units[$i] ?? '';\r\n+        $price = (float)($prices[$i] ?? 0);\r\n+        $total = (float)($totals[$i] ?? 0);\r\n \r\n-        $stmt->bind_param(\"isidss\", $quotation_id, $name, $qty, $price, $unit, $total);\r\n+        $stmt->bind_param(\"isiddd\", $receipt_id, $name, $qty, $unit, $price, $total);\r\n         $stmt->execute();\r\n     }\r\n     $stmt->close();\r\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='quotations1.html'>กรอกต่อ</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='receipts1.html'>กรอกต่อ</a>\";\r\n ?>\r\n"
                }
            ],
            "date": 1758459946506,
            "name": "Commit-0",
            "content": "<?php\r\n$servername = \"localhost\";\r\n$username = \"root\"; // เปลี่ยนตามจริง\r\n$password = \"\";     // เปลี่ยนตามจริง\r\n$dbname = \"shop_it\";\r\n\r\n// สร้างการเชื่อมต่อ\r\n$conn = new mysqli($servername, $username, $password, $dbname);\r\n\r\n// ตรวจสอบการเชื่อมต่อ\r\nif ($conn->connect_error) {\r\n    die(\"Connection failed: \" . $conn->connect_error);\r\n}\r\n\r\n// SQL สำหรับสร้างตาราง quotations\r\n$sql1 = \"CREATE TABLE IF NOT EXISTS quotations (\r\n    id INT(11) AUTO_INCREMENT PRIMARY KEY,\r\n    quotation_no VARCHAR(50) NOT NULL,\r\n    subject VARCHAR(255) NOT NULL,\r\n    recipient_name VARCHAR(255) NOT NULL,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\";\r\n\r\n// SQL สำหรับสร้างตาราง quotation_items\r\n$sql2 = \"CREATE TABLE IF NOT EXISTS quotation_items (\r\n    id INT(11) AUTO_INCREMENT PRIMARY KEY,\r\n    quotation_id INT(11) NOT NULL,\r\n    item_name VARCHAR(255) NOT NULL,\r\n    qty INT(11) DEFAULT 0,\r\n    price DECIMAL(10,2) DEFAULT 0.00,\r\n    unit VARCHAR(50) DEFAULT NULL,\r\n    total DECIMAL(10,2) DEFAULT 0.00,\r\n    FOREIGN KEY (quotation_id) REFERENCES quotations(id) ON DELETE CASCADE\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\";\r\n\r\n// รัน SQL\r\nif ($conn->query($sql1) === TRUE) {\r\n    echo \"ตาราง quotations ถูกสร้างเรียบร้อย<br>\";\r\n} else {\r\n    echo \"Error creating quotations: \" . $conn->error . \"<br>\";\r\n}\r\n\r\nif ($conn->query($sql2) === TRUE) {\r\n    echo \"ตาราง quotation_items ถูกสร้างเรียบร้อย<br>\";\r\n} else {\r\n    echo \"Error creating quotation_items: \" . $conn->error . \"<br>\";\r\n}\r\n\r\n$conn->close();\r\n?>\r\n"
        }
    ]
}