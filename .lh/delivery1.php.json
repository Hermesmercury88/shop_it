{
    "sourceFile": "delivery1.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 20,
            "patches": [
                {
                    "date": 1758461990516,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758552902353,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758552914552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> \";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> a\";\r\n ?>\r\n"
                },
                {
                    "date": 1758552924101,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> a\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยากกรอกต่อ\";\r\n ?>\r\n"
                },
                {
                    "date": 1758552935733,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยากกรอกต่อ\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก กรอกต่อ\";\r\n ?>\r\n"
                },
                {
                    "date": 1758552941553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก กรอกต่อ\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a harกรอกต่อ\";\r\n ?>\r\n"
                },
                {
                    "date": 1758552946668,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a harกรอกต่อ\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery1.php'>เพิ่มใบส่งของ</a> กรอกต่อ\";\r\n ?>\r\n"
                },
                {
                    "date": 1758552957127,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery1.php'>เพิ่มใบส่งของ</a> กรอกต่อ\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery1.php'>เพิ่มใบส่งของ</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758553060351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery1.php'>เพิ่มใบส่งของ</a> \";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery1.html'>กรอกต่อ</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758553522752,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,6 +58,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a haref='delivery1.html'>กรอกต่อ</a> \";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='delivery1.html'>กรอกต่อ</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758635708987,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,27 +37,30 @@\n $delivery_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // บันทึกรายการสินค้า\r\n+// บันทึกรายการสินค้า\r\n if (!empty($item_names)) {\r\n     $stmt = $conn->prepare(\"INSERT INTO delivery_items (delivery_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n     if (!$stmt) {\r\n         die(\"Prepare failed: \" . $conn->error);\r\n     }\r\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n         $name  = $item_names[$i] ?? '';\r\n-        $qty   = $qtys[$i]       ?? 0;\r\n-        $price = $prices[$i]     ?? 0.00;\r\n-        $unit  = $units[$i]      ?? '';\r\n-        $total = $totals[$i]     ?? 0.00;\r\n+        $qty   = (int)($qtys[$i] ?? 0);\r\n+        $price = (float)($prices[$i] ?? 0.00);\r\n+        $unit  = $units[$i] ?? '';\r\n+        $total = (float)($totals[$i] ?? 0.00);\r\n \r\n-        $stmt->bind_param(\"isidss\", $delivery_id, $name, $qty, $price, $unit, $total);\r\n+        // i = int, s = string, i = int, d = decimal, s = string, d = decimal\r\n+        $stmt->bind_param(\"isidsd\", $delivery_id, $name, $qty, $price, $unit, $total);\r\n         $stmt->execute();\r\n     }\r\n     $stmt->close();\r\n }\r\n \r\n+\r\n $conn->close();\r\n \r\n echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='delivery1.html'>กรอกต่อ</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758635722021,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,9 +37,8 @@\n $delivery_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // บันทึกรายการสินค้า\r\n-// บันทึกรายการสินค้า\r\n if (!empty($item_names)) {\r\n     $stmt = $conn->prepare(\"INSERT INTO delivery_items (delivery_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n     if (!$stmt) {\r\n         die(\"Prepare failed: \" . $conn->error);\r\n@@ -58,9 +57,8 @@\n     }\r\n     $stmt->close();\r\n }\r\n \r\n-\r\n $conn->close();\r\n \r\n echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='delivery1.html'>กรอกต่อ</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758713814805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,19 +26,47 @@\n $prices     = $_POST['price']     ?? [];\r\n $units      = $_POST['unit']      ?? [];\r\n $totals     = $_POST['total']     ?? [];\r\n \r\n+// ---------------------------\r\n+// อัพโหลดไฟล์ PDF\r\n+// ---------------------------\r\n+$pdf_file_path = null;\r\n+\r\n+if (!empty($_FILES['pdf_file']['name'])) {\r\n+    $targetDir = \"uploads/deliveries/\";\r\n+    if (!is_dir($targetDir)) {\r\n+        mkdir($targetDir, 0777, true); // สร้างโฟลเดอร์ถ้ายังไม่มี\r\n+    }\r\n+\r\n+    $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n+    $targetFilePath = $targetDir . $fileName;\r\n+\r\n+    $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n+\r\n+    // ตรวจสอบว่าเป็น PDF\r\n+    if ($fileType === \"pdf\") {\r\n+        if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n+            $pdf_file_path = $targetFilePath; // เก็บ path ลงฐานข้อมูล\r\n+        }\r\n+    }\r\n+}\r\n+\r\n+// ---------------------------\r\n // บันทึกใบส่งของ\r\n-$stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no) VALUES (?, ?, ?, ?)\");\r\n+// ---------------------------\r\n+$stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no, pdf_file) VALUES (?, ?, ?, ?, ?)\");\r\n if (!$stmt) {\r\n     die(\"Prepare failed: \" . $conn->error);\r\n }\r\n-$stmt->bind_param(\"ssss\", $delivery_no, $customer_name, $customer_address, $order_no);\r\n+$stmt->bind_param(\"sssss\", $delivery_no, $customer_name, $customer_address, $order_no, $pdf_file_path);\r\n $stmt->execute();\r\n $delivery_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n+// ---------------------------\r\n // บันทึกรายการสินค้า\r\n+// ---------------------------\r\n if (!empty($item_names)) {\r\n     $stmt = $conn->prepare(\"INSERT INTO delivery_items (delivery_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n     if (!$stmt) {\r\n         die(\"Prepare failed: \" . $conn->error);\r\n@@ -50,15 +78,14 @@\n         $price = (float)($prices[$i] ?? 0.00);\r\n         $unit  = $units[$i] ?? '';\r\n         $total = (float)($totals[$i] ?? 0.00);\r\n \r\n-        // i = int, s = string, i = int, d = decimal, s = string, d = decimal\r\n         $stmt->bind_param(\"isidsd\", $delivery_id, $name, $qty, $price, $unit, $total);\r\n         $stmt->execute();\r\n     }\r\n     $stmt->close();\r\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='delivery1.html'>กรอกต่อ</a> \";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='deliveries_list.php'>ไปหน้ารายการใบส่งของ</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758713834552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,6 +86,6 @@\n }\r\n \r\n $conn->close();\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='deliveries_list.php'>ไปหน้ารายการใบส่งของ</a>\";\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a> หรืออยาก <a href='delivery1.html'>กรอกต่อ</a> \";\r\n ?>\r\n"
                },
                {
                    "date": 1758714463936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,14 +29,17 @@\n \r\n // ---------------------------\r\n // อัพโหลดไฟล์ PDF\r\n // ---------------------------\r\n+// ---------------------------\r\n+// อัพโหลดไฟล์ PDF\r\n+// ---------------------------\r\n $pdf_file_path = null;\r\n \r\n if (!empty($_FILES['pdf_file']['name'])) {\r\n-    $targetDir = \"uploads/deliveries/\";\r\n+    $targetDir = \"uploads/deliveries/\";   // เก็บไฟล์ไว้ในโฟลเดอร์นี้\r\n     if (!is_dir($targetDir)) {\r\n-        mkdir($targetDir, 0777, true); // สร้างโฟลเดอร์ถ้ายังไม่มี\r\n+        mkdir($targetDir, 0777, true); // ถ้าไม่มีโฟลเดอร์ ให้สร้างใหม่\r\n     }\r\n \r\n     $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n     $targetFilePath = $targetDir . $fileName;\r\n@@ -45,13 +48,15 @@\n \r\n     // ตรวจสอบว่าเป็น PDF\r\n     if ($fileType === \"pdf\") {\r\n         if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n-            $pdf_file_path = $targetFilePath; // เก็บ path ลงฐานข้อมูล\r\n+            // เก็บเฉพาะ path ที่เบราว์เซอร์ใช้ได้\r\n+            $pdf_file_path = $targetFilePath;  // ตัวอย่าง: uploads/deliveries/1695563729_test.pdf\r\n         }\r\n     }\r\n }\r\n \r\n+\r\n // ---------------------------\r\n // บันทึกใบส่งของ\r\n // ---------------------------\r\n $stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no, pdf_file) VALUES (?, ?, ?, ?, ?)\");\r\n"
                },
                {
                    "date": 1758714469088,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -54,9 +54,8 @@\n         }\r\n     }\r\n }\r\n \r\n-\r\n // ---------------------------\r\n // บันทึกใบส่งของ\r\n // ---------------------------\r\n $stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no, pdf_file) VALUES (?, ?, ?, ?, ?)\");\r\n"
                },
                {
                    "date": 1758714958166,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,16 +57,32 @@\n \r\n // ---------------------------\r\n // บันทึกใบส่งของ\r\n // ---------------------------\r\n-$stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no, pdf_file) VALUES (?, ?, ?, ?, ?)\");\r\n-if (!$stmt) {\r\n-    die(\"Prepare failed: \" . $conn->error);\r\n+$pdf_file_path = null;\r\n+\r\n+if (!empty($_FILES['pdf_file']['name'])) {\r\n+    // ตรวจสอบว่ามีโฟลเดอร์ uploads/deliveries หรือยัง ถ้าไม่มีสร้างใหม่\r\n+    if (!is_dir('uploads/deliveries')) {\r\n+        mkdir('uploads/deliveries', 0777, true);\r\n+    }\r\n+\r\n+    $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n+    $targetFilePath = 'uploads/deliveries/' . $fileName;\r\n+\r\n+    $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n+\r\n+    // ตรวจสอบว่าเป็น PDF\r\n+    if ($fileType === \"pdf\") {\r\n+        if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n+            $pdf_file_path = $targetFilePath; // เก็บ path ลงฐานข้อมูล\r\n+        } else {\r\n+            die(\"ไม่สามารถอัพโหลดไฟล์ได้\");\r\n+        }\r\n+    } else {\r\n+        die(\"ไฟล์ต้องเป็น PDF เท่านั้น\");\r\n+    }\r\n }\r\n-$stmt->bind_param(\"sssss\", $delivery_no, $customer_name, $customer_address, $order_no, $pdf_file_path);\r\n-$stmt->execute();\r\n-$delivery_id = $stmt->insert_id;\r\n-$stmt->close();\r\n \r\n // ---------------------------\r\n // บันทึกรายการสินค้า\r\n // ---------------------------\r\n"
                },
                {
                    "date": 1758714976448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,33 +57,19 @@\n \r\n // ---------------------------\r\n // บันทึกใบส่งของ\r\n // ---------------------------\r\n-$pdf_file_path = null;\r\n+$stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no, pdf_file) VALUES (?, ?, ?, ?, ?)\");\r\n+if (!$stmt) {\r\n+    die(\"Prepare failed: \" . $conn->error);\r\n+}\r\n+$stmt->bind_param(\"sssss\", $delivery_no, $customer_name, $customer_address, $order_no, $pdf_file_path);\r\n+$stmt->execute();\r\n+$delivery_id = $stmt->insert_id;\r\n+$stmt->close();\r\n \r\n-if (!empty($_FILES['pdf_file']['name'])) {\r\n-    // ตรวจสอบว่ามีโฟลเดอร์ uploads/deliveries หรือยัง ถ้าไม่มีสร้างใหม่\r\n-    if (!is_dir('uploads/deliveries')) {\r\n-        mkdir('uploads/deliveries', 0777, true);\r\n-    }\r\n \r\n-    $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n-    $targetFilePath = 'uploads/deliveries/' . $fileName;\r\n \r\n-    $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n-\r\n-    // ตรวจสอบว่าเป็น PDF\r\n-    if ($fileType === \"pdf\") {\r\n-        if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n-            $pdf_file_path = $targetFilePath; // เก็บ path ลงฐานข้อมูล\r\n-        } else {\r\n-            die(\"ไม่สามารถอัพโหลดไฟล์ได้\");\r\n-        }\r\n-    } else {\r\n-        die(\"ไฟล์ต้องเป็น PDF เท่านั้น\");\r\n-    }\r\n-}\r\n-\r\n // ---------------------------\r\n // บันทึกรายการสินค้า\r\n // ---------------------------\r\n if (!empty($item_names)) {\r\n"
                },
                {
                    "date": 1758714988017,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -66,10 +66,8 @@\n $stmt->execute();\r\n $delivery_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n-\r\n-\r\n // ---------------------------\r\n // บันทึกรายการสินค้า\r\n // ---------------------------\r\n if (!empty($item_names)) {\r\n"
                },
                {
                    "date": 1758714993550,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,11 +29,8 @@\n \r\n // ---------------------------\r\n // อัพโหลดไฟล์ PDF\r\n // ---------------------------\r\n-// ---------------------------\r\n-// อัพโหลดไฟล์ PDF\r\n-// ---------------------------\r\n $pdf_file_path = null;\r\n \r\n if (!empty($_FILES['pdf_file']['name'])) {\r\n     $targetDir = \"uploads/deliveries/\";   // เก็บไฟล์ไว้ในโฟลเดอร์นี้\r\n"
                },
                {
                    "date": 1758715013214,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,24 +32,27 @@\n // ---------------------------\r\n $pdf_file_path = null;\r\n \r\n if (!empty($_FILES['pdf_file']['name'])) {\r\n-    $targetDir = \"uploads/deliveries/\";   // เก็บไฟล์ไว้ในโฟลเดอร์นี้\r\n-    if (!is_dir($targetDir)) {\r\n-        mkdir($targetDir, 0777, true); // ถ้าไม่มีโฟลเดอร์ ให้สร้างใหม่\r\n+    // ตรวจสอบว่ามีโฟลเดอร์ uploads/deliveries หรือยัง ถ้าไม่มีสร้างใหม่\r\n+    if (!is_dir('uploads/deliveries')) {\r\n+        mkdir('uploads/deliveries', 0777, true);\r\n     }\r\n \r\n     $fileName = time() . \"_\" . basename($_FILES[\"pdf_file\"][\"name\"]);\r\n-    $targetFilePath = $targetDir . $fileName;\r\n+    $targetFilePath = 'uploads/deliveries/' . $fileName;\r\n \r\n     $fileType = strtolower(pathinfo($targetFilePath, PATHINFO_EXTENSION));\r\n \r\n     // ตรวจสอบว่าเป็น PDF\r\n     if ($fileType === \"pdf\") {\r\n         if (move_uploaded_file($_FILES[\"pdf_file\"][\"tmp_name\"], $targetFilePath)) {\r\n-            // เก็บเฉพาะ path ที่เบราว์เซอร์ใช้ได้\r\n-            $pdf_file_path = $targetFilePath;  // ตัวอย่าง: uploads/deliveries/1695563729_test.pdf\r\n+            $pdf_file_path = $targetFilePath; // เก็บ path ลงฐานข้อมูล\r\n+        } else {\r\n+            die(\"ไม่สามารถอัพโหลดไฟล์ได้\");\r\n         }\r\n+    } else {\r\n+        die(\"ไฟล์ต้องเป็น PDF เท่านั้น\");\r\n     }\r\n }\r\n \r\n // ---------------------------\r\n"
                }
            ],
            "date": 1758461990516,
            "name": "Commit-0",
            "content": "<?php\r\n$host = \"localhost\";\r\n$user = \"root\";\r\n$pass = \"\";\r\n$dbname = \"shop_it\";\r\n\r\n// เชื่อมต่อฐานข้อมูล\r\n$conn = new mysqli($host, $user, $pass, $dbname);\r\nif ($conn->connect_error) {\r\n    die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n}\r\n\r\n// ตรวจสอบ method\r\nif ($_SERVER['REQUEST_METHOD'] !== 'POST') {\r\n    die(\"กรุณาส่งข้อมูลด้วย POST\");\r\n}\r\n\r\n// รับค่าจากฟอร์ม\r\n$delivery_no       = $_POST['delivery_no']       ?? '';\r\n$customer_name     = $_POST['customer_name']     ?? '';\r\n$customer_address  = $_POST['customer_address']  ?? '';\r\n$order_no          = $_POST['order_no']          ?? '';\r\n\r\n$item_names = $_POST['item_name'] ?? [];\r\n$qtys       = $_POST['qty']       ?? [];\r\n$prices     = $_POST['price']     ?? [];\r\n$units      = $_POST['unit']      ?? [];\r\n$totals     = $_POST['total']     ?? [];\r\n\r\n// บันทึกใบส่งของ\r\n$stmt = $conn->prepare(\"INSERT INTO deliveries (delivery_no, customer_name, customer_address, order_no) VALUES (?, ?, ?, ?)\");\r\nif (!$stmt) {\r\n    die(\"Prepare failed: \" . $conn->error);\r\n}\r\n$stmt->bind_param(\"ssss\", $delivery_no, $customer_name, $customer_address, $order_no);\r\n$stmt->execute();\r\n$delivery_id = $stmt->insert_id;\r\n$stmt->close();\r\n\r\n// บันทึกรายการสินค้า\r\nif (!empty($item_names)) {\r\n    $stmt = $conn->prepare(\"INSERT INTO delivery_items (delivery_id, item_name, qty, price, unit, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n    if (!$stmt) {\r\n        die(\"Prepare failed: \" . $conn->error);\r\n    }\r\n\r\n    for ($i = 0; $i < count($item_names); $i++) {\r\n        $name  = $item_names[$i] ?? '';\r\n        $qty   = $qtys[$i]       ?? 0;\r\n        $price = $prices[$i]     ?? 0.00;\r\n        $unit  = $units[$i]      ?? '';\r\n        $total = $totals[$i]     ?? 0.00;\r\n\r\n        $stmt->bind_param(\"isidss\", $delivery_id, $name, $qty, $price, $unit, $total);\r\n        $stmt->execute();\r\n    }\r\n    $stmt->close();\r\n}\r\n\r\n$conn->close();\r\n\r\necho \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n?>\r\n"
        }
    ]
}