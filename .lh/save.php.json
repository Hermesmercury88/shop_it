{
    "sourceFile": "save.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 16,
            "patches": [
                {
                    "date": 1758357915147,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758357941841,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,10 +8,9 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n-$order_no = $_POST['order_no'];\r\n-\r\n+$order_no = $_POST['order_no'];   // ✅ เพิ่มตรงนี้\r\n $customer_name = $_POST['customer_name'];\r\n $customer_address = $_POST['customer_address'];\r\n $grand_total = $_POST['grand_total'];\r\n \r\n@@ -21,16 +20,18 @@\n $prices = $_POST['price'];\r\n $totals = $_POST['total'];\r\n \r\n // บันทึกใบเสร็จ\r\n-$stmt = $conn->prepare(\"INSERT INTO receipts (customer_name, customer_address, grand_total) VALUES (?, ?, ?)\");\r\n-$stmt->bind_param(\"ssd\", $customer_name, $customer_address, $grand_total);\r\n+$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) \r\n+                        VALUES (?, ?, ?, ?)\");\r\n+$stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n $stmt->execute();\r\n $receipt_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // บันทึกรายละเอียดสินค้า\r\n-$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n+$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) \r\n+                        VALUES (?, ?, ?, ?, ?, ?)\");\r\n for($i=0; $i<count($item_names); $i++){\r\n     $stmt->bind_param(\"isiddd\", $receipt_id, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n     $stmt->execute();\r\n }\r\n"
                },
                {
                    "date": 1758358386351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,20 +20,18 @@\n $prices = $_POST['price'];\r\n $totals = $_POST['total'];\r\n \r\n // บันทึกใบเสร็จ\r\n-$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) \r\n-                        VALUES (?, ?, ?, ?)\");\r\n+$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n $stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n $stmt->execute();\r\n $receipt_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // บันทึกรายละเอียดสินค้า\r\n-$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) \r\n-                        VALUES (?, ?, ?, ?, ?, ?)\");\r\n+$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, order_no, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?, ?)\");\r\n for($i=0; $i<count($item_names); $i++){\r\n-    $stmt->bind_param(\"isiddd\", $receipt_id, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n+    $stmt->bind_param(\"issiddd\", $receipt_id, $order_no, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n     $stmt->execute();\r\n }\r\n $stmt->close();\r\n $conn->close();\r\n"
                },
                {
                    "date": 1758358493812,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,9 @@\n <?php\r\n+<?php\r\n+error_reporting(E_ALL);\r\n+ini_set('display_errors', 1);\r\n+\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n $dbname = \"shop_it\";\r\n"
                },
                {
                    "date": 1758358680297,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,5 @@\n <?php\r\n-<?php\r\n error_reporting(E_ALL);\r\n ini_set('display_errors', 1);\r\n \r\n $host = \"localhost\";\r\n@@ -12,9 +11,9 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n-$order_no = $_POST['order_no'];   // ✅ เพิ่มตรงนี้\r\n+$order_no = $_POST['order_no'];   \r\n $customer_name = $_POST['customer_name'];\r\n $customer_address = $_POST['customer_address'];\r\n $grand_total = $_POST['grand_total'];\r\n \r\n"
                },
                {
                    "date": 1758359123138,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,43 +1,65 @@\n <?php\r\n-error_reporting(E_ALL);\r\n-ini_set('display_errors', 1);\r\n+require 'vendor/autoload.php'; // ถ้าใช้ Composer\r\n+use Dompdf\\Dompdf;\r\n \r\n-$host = \"localhost\";\r\n-$user = \"root\";\r\n-$pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+// รับค่าจากฟอร์ม\r\n+$customer = $_POST['customer_name'];\r\n+$address = $_POST['customer_address'];\r\n+$items = $_POST['items']; // array\r\n \r\n-// เชื่อมต่อฐานข้อมูล\r\n-$conn = new mysqli($host, $user, $pass, $dbname);\r\n-if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n+// สร้าง HTML สำหรับ PDF\r\n+$html = \"\r\n+<h2 style='text-align:center;'>ใบเสร็จรับเงิน</h2>\r\n+<p><b>ชื่อลูกค้า:</b> $customer</p>\r\n+<p><b>ที่อยู่:</b> $address</p>\r\n+<table border='1' width='100%' cellspacing='0' cellpadding='5'>\r\n+    <tr>\r\n+        <th>ลำดับ</th>\r\n+        <th>รายการ</th>\r\n+        <th>จำนวน</th>\r\n+        <th>หน่วย</th>\r\n+        <th>ราคา</th>\r\n+        <th>รวม</th>\r\n+    </tr>\r\n+\";\r\n \r\n-// รับข้อมูล\r\n-$order_no = $_POST['order_no'];   \r\n-$customer_name = $_POST['customer_name'];\r\n-$customer_address = $_POST['customer_address'];\r\n-$grand_total = $_POST['grand_total'];\r\n+// ใส่รายการสินค้า\r\n+$total = 0;\r\n+foreach ($items as $i => $item) {\r\n+    $sum = $item['qty'] * $item['price'];\r\n+    $total += $sum;\r\n+    $html .= \"\r\n+    <tr>\r\n+        <td>\".($i+1).\"</td>\r\n+        <td>{$item['name']}</td>\r\n+        <td>{$item['qty']}</td>\r\n+        <td>{$item['unit']}</td>\r\n+        <td>{$item['price']}</td>\r\n+        <td>$sum</td>\r\n+    </tr>\";\r\n+}\r\n \r\n-$item_names = $_POST['item_name'];\r\n-$qtys = $_POST['qty'];\r\n-$units = $_POST['unit'];\r\n-$prices = $_POST['price'];\r\n-$totals = $_POST['total'];\r\n+$html .= \"\r\n+    <tr>\r\n+        <td colspan='5' align='right'><b>รวมทั้งหมด</b></td>\r\n+        <td><b>$total</b></td>\r\n+    </tr>\r\n+</table>\r\n+<p style='margin-top:50px;'>ลงชื่อผู้รับเงิน ...........................................</p>\r\n+\";\r\n \r\n-// บันทึกใบเสร็จ\r\n-$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n-$stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n-$stmt->execute();\r\n-$receipt_id = $stmt->insert_id;\r\n-$stmt->close();\r\n+// สร้าง PDF\r\n+$dompdf = new Dompdf();\r\n+$dompdf->loadHtml($html);\r\n+$dompdf->setPaper('A4', 'portrait');\r\n+$dompdf->render();\r\n \r\n-// บันทึกรายละเอียดสินค้า\r\n-$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, order_no, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?, ?)\");\r\n-for($i=0; $i<count($item_names); $i++){\r\n-    $stmt->bind_param(\"issiddd\", $receipt_id, $order_no, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n-    $stmt->execute();\r\n-}\r\n-$stmt->close();\r\n-$conn->close();\r\n+// บันทึกเป็นไฟล์\r\n+$output = $dompdf->output();\r\n+$filename = \"receipt_\" . time() . \".pdf\";\r\n+file_put_contents(\"receipt_pdfs/$filename\", $output);\r\n \r\n-echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n-?>\r\n+// โหลดไฟล์ให้ user ดาวน์โหลด\r\n+header(\"Content-type: application/pdf\");\r\n+header(\"Content-Disposition: inline; filename=$filename\");\r\n+echo $output;\r\n"
                },
                {
                    "date": 1758359137835,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,65 +1,43 @@\n <?php\r\n-require 'vendor/autoload.php'; // ถ้าใช้ Composer\r\n-use Dompdf\\Dompdf;\r\n+error_reporting(E_ALL);\r\n+ini_set('display_errors', 1);\r\n \r\n-// รับค่าจากฟอร์ม\r\n-$customer = $_POST['customer_name'];\r\n-$address = $_POST['customer_address'];\r\n-$items = $_POST['items']; // array\r\n+$host = \"localhost\";\r\n+$user = \"root\";\r\n+$pass = \"\";\r\n+$dbname = \"shop_it\";\r\n \r\n-// สร้าง HTML สำหรับ PDF\r\n-$html = \"\r\n-<h2 style='text-align:center;'>ใบเสร็จรับเงิน</h2>\r\n-<p><b>ชื่อลูกค้า:</b> $customer</p>\r\n-<p><b>ที่อยู่:</b> $address</p>\r\n-<table border='1' width='100%' cellspacing='0' cellpadding='5'>\r\n-    <tr>\r\n-        <th>ลำดับ</th>\r\n-        <th>รายการ</th>\r\n-        <th>จำนวน</th>\r\n-        <th>หน่วย</th>\r\n-        <th>ราคา</th>\r\n-        <th>รวม</th>\r\n-    </tr>\r\n-\";\r\n+// เชื่อมต่อฐานข้อมูล\r\n+$conn = new mysqli($host, $user, $pass, $dbname);\r\n+if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n-// ใส่รายการสินค้า\r\n-$total = 0;\r\n-foreach ($items as $i => $item) {\r\n-    $sum = $item['qty'] * $item['price'];\r\n-    $total += $sum;\r\n-    $html .= \"\r\n-    <tr>\r\n-        <td>\".($i+1).\"</td>\r\n-        <td>{$item['name']}</td>\r\n-        <td>{$item['qty']}</td>\r\n-        <td>{$item['unit']}</td>\r\n-        <td>{$item['price']}</td>\r\n-        <td>$sum</td>\r\n-    </tr>\";\r\n-}\r\n+// รับข้อมูล\r\n+$order_no = $_POST['order_no'];   \r\n+$customer_name = $_POST['customer_name'];\r\n+$customer_address = $_POST['customer_address'];\r\n+$grand_total = $_POST['grand_total'];\r\n \r\n-$html .= \"\r\n-    <tr>\r\n-        <td colspan='5' align='right'><b>รวมทั้งหมด</b></td>\r\n-        <td><b>$total</b></td>\r\n-    </tr>\r\n-</table>\r\n-<p style='margin-top:50px;'>ลงชื่อผู้รับเงิน ...........................................</p>\r\n-\";\r\n+$item_names = $_POST['item_name'];\r\n+$qtys = $_POST['qty'];\r\n+$units = $_POST['unit'];\r\n+$prices = $_POST['price'];\r\n+$totals = $_POST['total'];\r\n \r\n-// สร้าง PDF\r\n-$dompdf = new Dompdf();\r\n-$dompdf->loadHtml($html);\r\n-$dompdf->setPaper('A4', 'portrait');\r\n-$dompdf->render();\r\n+// บันทึกใบเสร็จ\r\n+$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n+$stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n+$stmt->execute();\r\n+$receipt_id = $stmt->insert_id;\r\n+$stmt->close();\r\n \r\n-// บันทึกเป็นไฟล์\r\n-$output = $dompdf->output();\r\n-$filename = \"receipt_\" . time() . \".pdf\";\r\n-file_put_contents(\"receipt_pdfs/$filename\", $output);\r\n+// บันทึกรายละเอียดสินค้า\r\n+$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, order_no, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?, ?)\");\r\n+for($i=0; $i<count($item_names); $i++){\r\n+    $stmt->bind_param(\"issiddd\", $receipt_id, $order_no, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n+    $stmt->execute();\r\n+}\r\n+$stmt->close();\r\n+$conn->close();\r\n \r\n-// โหลดไฟล์ให้ user ดาวน์โหลด\r\n-header(\"Content-type: application/pdf\");\r\n-header(\"Content-Disposition: inline; filename=$filename\");\r\n-echo $output;\r\n+echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n+?>\r\n"
                },
                {
                    "date": 1758359212763,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,5 @@\n <?php\r\n-error_reporting(E_ALL);\r\n-ini_set('display_errors', 1);\r\n-\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n $dbname = \"shop_it\";\r\n@@ -11,9 +8,8 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n-$order_no = $_POST['order_no'];   \r\n $customer_name = $_POST['customer_name'];\r\n $customer_address = $_POST['customer_address'];\r\n $grand_total = $_POST['grand_total'];\r\n \r\n@@ -23,18 +19,18 @@\n $prices = $_POST['price'];\r\n $totals = $_POST['total'];\r\n \r\n // บันทึกใบเสร็จ\r\n-$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n-$stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n+$stmt = $conn->prepare(\"INSERT INTO receipts (customer_name, customer_address, grand_total) VALUES (?, ?, ?)\");\r\n+$stmt->bind_param(\"ssd\", $customer_name, $customer_address, $grand_total);\r\n $stmt->execute();\r\n $receipt_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // บันทึกรายละเอียดสินค้า\r\n-$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, order_no, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?, ?)\");\r\n+$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n for($i=0; $i<count($item_names); $i++){\r\n-    $stmt->bind_param(\"issiddd\", $receipt_id, $order_no, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n+    $stmt->bind_param(\"isiddd\", $receipt_id, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n     $stmt->execute();\r\n }\r\n $stmt->close();\r\n $conn->close();\r\n"
                },
                {
                    "date": 1758359302078,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,8 +8,9 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n+$order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n $customer_name = $_POST['customer_name'];\r\n $customer_address = $_POST['customer_address'];\r\n $grand_total = $_POST['grand_total'];\r\n \r\n@@ -18,11 +19,11 @@\n $units = $_POST['unit'];\r\n $prices = $_POST['price'];\r\n $totals = $_POST['total'];\r\n \r\n-// บันทึกใบเสร็จ\r\n-$stmt = $conn->prepare(\"INSERT INTO receipts (customer_name, customer_address, grand_total) VALUES (?, ?, ?)\");\r\n-$stmt->bind_param(\"ssd\", $customer_name, $customer_address, $grand_total);\r\n+// บันทึกใบเสร็จ พร้อม order_no\r\n+$stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n+$stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n $stmt->execute();\r\n $receipt_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n"
                },
                {
                    "date": 1758360339246,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,18 +8,18 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n-$order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n-$customer_name = $_POST['customer_name'];\r\n-$customer_address = $_POST['customer_address'];\r\n-$grand_total = $_POST['grand_total'];\r\n+// $order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n+// $customer_name = $_POST['customer_name'];\r\n+// $customer_address = $_POST['customer_address'];\r\n+// $grand_total = $_POST['grand_total'];\r\n \r\n-$item_names = $_POST['item_name'];\r\n-$qtys = $_POST['qty'];\r\n-$units = $_POST['unit'];\r\n-$prices = $_POST['price'];\r\n-$totals = $_POST['total'];\r\n+// $item_names = $_POST['item_name'];\r\n+// $qtys = $_POST['qty'];\r\n+// $units = $_POST['unit'];\r\n+// $prices = $_POST['price'];\r\n+// $totals = $_POST['total'];\r\n \r\n // บันทึกใบเสร็จ พร้อม order_no\r\n $stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n $stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n"
                },
                {
                    "date": 1758360756744,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,19 +8,21 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n-// $order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n-// $customer_name = $_POST['customer_name'];\r\n-// $customer_address = $_POST['customer_address'];\r\n-// $grand_total = $_POST['grand_total'];\r\n \r\n-// $item_names = $_POST['item_name'];\r\n-// $qtys = $_POST['qty'];\r\n-// $units = $_POST['unit'];\r\n-// $prices = $_POST['price'];\r\n-// $totals = $_POST['total'];\r\n+$order_no = $_POST['order_no'] ?? '';\r\n+$customer_name = $_POST['customer_name'] ?? '';\r\n+$customer_address = $_POST['customer_address'] ?? '';\r\n+$grand_total = $_POST['grand_total'] ?? 0;\r\n \r\n+$item_names = $_POST['item_name'] ?? [];\r\n+$qtys = $_POST['qty'] ?? [];\r\n+$units = $_POST['unit'] ?? [];\r\n+$prices = $_POST['price'] ?? [];\r\n+$totals = $_POST['total'] ?? [];\r\n+\r\n+\r\n // บันทึกใบเสร็จ พร้อม order_no\r\n $stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n $stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n $stmt->execute();\r\n"
                },
                {
                    "date": 1758361056581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,19 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n+// $order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n+// $customer_name = $_POST['customer_name'];\r\n+// $customer_address = $_POST['customer_address'];\r\n+// $grand_total = $_POST['grand_total'];\r\n \r\n+// $item_names = $_POST['item_name'];\r\n+// $qtys = $_POST['qty'];\r\n+// $units = $_POST['unit'];\r\n+// $prices = $_POST['price'];\r\n+// $totals = $_POST['total'];\r\n+\r\n $order_no = $_POST['order_no'] ?? '';\r\n $customer_name = $_POST['customer_name'] ?? '';\r\n $customer_address = $_POST['customer_address'] ?? '';\r\n $grand_total = $_POST['grand_total'] ?? 0;\r\n"
                },
                {
                    "date": 1758361063384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,29 +8,29 @@\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n \r\n // รับข้อมูล\r\n-// $order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n-// $customer_name = $_POST['customer_name'];\r\n-// $customer_address = $_POST['customer_address'];\r\n-// $grand_total = $_POST['grand_total'];\r\n+$order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n+$customer_name = $_POST['customer_name'];\r\n+$customer_address = $_POST['customer_address'];\r\n+$grand_total = $_POST['grand_total'];\r\n \r\n-// $item_names = $_POST['item_name'];\r\n-// $qtys = $_POST['qty'];\r\n-// $units = $_POST['unit'];\r\n-// $prices = $_POST['price'];\r\n-// $totals = $_POST['total'];\r\n+$item_names = $_POST['item_name'];\r\n+$qtys = $_POST['qty'];\r\n+$units = $_POST['unit'];\r\n+$prices = $_POST['price'];\r\n+$totals = $_POST['total'];\r\n \r\n-$order_no = $_POST['order_no'] ?? '';\r\n-$customer_name = $_POST['customer_name'] ?? '';\r\n-$customer_address = $_POST['customer_address'] ?? '';\r\n-$grand_total = $_POST['grand_total'] ?? 0;\r\n+// $order_no = $_POST['order_no'] ?? '';\r\n+// $customer_name = $_POST['customer_name'] ?? '';\r\n+// $customer_address = $_POST['customer_address'] ?? '';\r\n+// $grand_total = $_POST['grand_total'] ?? 0;\r\n \r\n-$item_names = $_POST['item_name'] ?? [];\r\n-$qtys = $_POST['qty'] ?? [];\r\n-$units = $_POST['unit'] ?? [];\r\n-$prices = $_POST['price'] ?? [];\r\n-$totals = $_POST['total'] ?? [];\r\n+// $item_names = $_POST['item_name'] ?? [];\r\n+// $qtys = $_POST['qty'] ?? [];\r\n+// $units = $_POST['unit'] ?? [];\r\n+// $prices = $_POST['price'] ?? [];\r\n+// $totals = $_POST['total'] ?? [];\r\n \r\n \r\n // บันทึกใบเสร็จ พร้อม order_no\r\n $stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n"
                },
                {
                    "date": 1758427396981,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,48 +5,59 @@\n $dbname = \"shop_it\";\r\n \r\n // เชื่อมต่อฐานข้อมูล\r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n-if ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n+if ($conn->connect_error) {\r\n+    die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n+}\r\n \r\n-// รับข้อมูล\r\n-$order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n-$customer_name = $_POST['customer_name'];\r\n-$customer_address = $_POST['customer_address'];\r\n-$grand_total = $_POST['grand_total'];\r\n+// ตรวจสอบว่ามีการส่ง POST หรือไม่\r\n+if ($_SERVER['REQUEST_METHOD'] !== 'POST') {\r\n+    die(\"กรุณาส่งข้อมูลด้วย POST\");\r\n+}\r\n \r\n-$item_names = $_POST['item_name'];\r\n-$qtys = $_POST['qty'];\r\n-$units = $_POST['unit'];\r\n-$prices = $_POST['price'];\r\n-$totals = $_POST['total'];\r\n+// รับข้อมูลจากฟอร์ม (ตั้งค่า default ป้องกัน Warning)\r\n+$order_no = $_POST['order_no'] ?? '';\r\n+$customer_name = $_POST['customer_name'] ?? '';\r\n+$customer_address = $_POST['customer_address'] ?? '';\r\n+$grand_total = $_POST['grand_total'] ?? 0;\r\n \r\n-// $order_no = $_POST['order_no'] ?? '';\r\n-// $customer_name = $_POST['customer_name'] ?? '';\r\n-// $customer_address = $_POST['customer_address'] ?? '';\r\n-// $grand_total = $_POST['grand_total'] ?? 0;\r\n+$item_names = $_POST['item_name'] ?? [];\r\n+$qtys = $_POST['qty'] ?? [];\r\n+$units = $_POST['unit'] ?? [];\r\n+$prices = $_POST['price'] ?? [];\r\n+$totals = $_POST['total'] ?? [];\r\n \r\n-// $item_names = $_POST['item_name'] ?? [];\r\n-// $qtys = $_POST['qty'] ?? [];\r\n-// $units = $_POST['unit'] ?? [];\r\n-// $prices = $_POST['price'] ?? [];\r\n-// $totals = $_POST['total'] ?? [];\r\n-\r\n-\r\n-// บันทึกใบเสร็จ พร้อม order_no\r\n+// บันทึกใบเสร็จ\r\n $stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n+if (!$stmt) {\r\n+    die(\"Prepare failed: \" . $conn->error);\r\n+}\r\n $stmt->bind_param(\"sssd\", $order_no, $customer_name, $customer_address, $grand_total);\r\n $stmt->execute();\r\n $receipt_id = $stmt->insert_id;\r\n $stmt->close();\r\n \r\n // บันทึกรายละเอียดสินค้า\r\n-$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n-for($i=0; $i<count($item_names); $i++){\r\n-    $stmt->bind_param(\"isiddd\", $receipt_id, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n-    $stmt->execute();\r\n+if (!empty($item_names)) {\r\n+    $stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\n+    if (!$stmt) {\r\n+        die(\"Prepare failed: \" . $conn->error);\r\n+    }\r\n+\r\n+    for ($i = 0; $i < count($item_names); $i++) {\r\n+        $name = $item_names[$i];\r\n+        $qty = $qtys[$i] ?? 0;\r\n+        $unit = $units[$i] ?? '';\r\n+        $price = $prices[$i] ?? 0;\r\n+        $total = $totals[$i] ?? 0;\r\n+\r\n+        $stmt->bind_param(\"isiddd\", $receipt_id, $name, $qty, $unit, $price, $total);\r\n+        $stmt->execute();\r\n+    }\r\n+    $stmt->close();\r\n }\r\n-$stmt->close();\r\n+\r\n $conn->close();\r\n \r\n echo \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n ?>\r\n"
                },
                {
                    "date": 1758439751139,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -23,9 +23,8 @@\n \r\n $item_names = $_POST['item_name'] ?? [];\r\n $qtys = $_POST['qty'] ?? [];\r\n $units = $_POST['unit'] ?? [];\r\n-$prices = $_POST['price'] ?? [];\r\n $totals = $_POST['total'] ?? [];\r\n \r\n // บันทึกใบเสร็จ\r\n $stmt = $conn->prepare(\"INSERT INTO receipts (order_no, customer_name, customer_address, grand_total) VALUES (?, ?, ?, ?)\");\r\n"
                },
                {
                    "date": 1758439762785,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,8 +22,9 @@\n $grand_total = $_POST['grand_total'] ?? 0;\r\n \r\n $item_names = $_POST['item_name'] ?? [];\r\n $qtys = $_POST['qty'] ?? [];\r\n+$prices = $_POST['price'] ?? [];\r\n $units = $_POST['unit'] ?? [];\r\n $totals = $_POST['total'] ?? [];\r\n \r\n // บันทึกใบเสร็จ\r\n@@ -46,9 +47,9 @@\n     for ($i = 0; $i < count($item_names); $i++) {\r\n         $name = $item_names[$i];\r\n         $qty = $qtys[$i] ?? 0;\r\n         $unit = $units[$i] ?? '';\r\n-        $price = $prices[$i] ?? 0;\r\n+        \r\n         $total = $totals[$i] ?? 0;\r\n \r\n         $stmt->bind_param(\"isiddd\", $receipt_id, $name, $qty, $unit, $price, $total);\r\n         $stmt->execute();\r\n"
                },
                {
                    "date": 1758439768065,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -46,10 +46,10 @@\n \r\n     for ($i = 0; $i < count($item_names); $i++) {\r\n         $name = $item_names[$i];\r\n         $qty = $qtys[$i] ?? 0;\r\n+        $price = $prices[$i] ?? 0;\r\n         $unit = $units[$i] ?? '';\r\n-        \r\n         $total = $totals[$i] ?? 0;\r\n \r\n         $stmt->bind_param(\"isiddd\", $receipt_id, $name, $qty, $unit, $price, $total);\r\n         $stmt->execute();\r\n"
                }
            ],
            "date": 1758357915147,
            "name": "Commit-0",
            "content": "<?php\r\n$host = \"localhost\";\r\n$user = \"root\";\r\n$pass = \"\";\r\n$dbname = \"shop_it\";\r\n\r\n// เชื่อมต่อฐานข้อมูล\r\n$conn = new mysqli($host, $user, $pass, $dbname);\r\nif ($conn->connect_error) die(\"เชื่อมต่อฐานข้อมูลล้มเหลว: \" . $conn->connect_error);\r\n\r\n// รับข้อมูล\r\n$order_no = $_POST['order_no'];\r\n\r\n$customer_name = $_POST['customer_name'];\r\n$customer_address = $_POST['customer_address'];\r\n$grand_total = $_POST['grand_total'];\r\n\r\n$item_names = $_POST['item_name'];\r\n$qtys = $_POST['qty'];\r\n$units = $_POST['unit'];\r\n$prices = $_POST['price'];\r\n$totals = $_POST['total'];\r\n\r\n// บันทึกใบเสร็จ\r\n$stmt = $conn->prepare(\"INSERT INTO receipts (customer_name, customer_address, grand_total) VALUES (?, ?, ?)\");\r\n$stmt->bind_param(\"ssd\", $customer_name, $customer_address, $grand_total);\r\n$stmt->execute();\r\n$receipt_id = $stmt->insert_id;\r\n$stmt->close();\r\n\r\n// บันทึกรายละเอียดสินค้า\r\n$stmt = $conn->prepare(\"INSERT INTO receipt_items (receipt_id, item_name, qty, unit, price, total) VALUES (?, ?, ?, ?, ?, ?)\");\r\nfor($i=0; $i<count($item_names); $i++){\r\n    $stmt->bind_param(\"isiddd\", $receipt_id, $item_names[$i], $qtys[$i], $units[$i], $prices[$i], $totals[$i]);\r\n    $stmt->execute();\r\n}\r\n$stmt->close();\r\n$conn->close();\r\n\r\necho \"บันทึกข้อมูลเรียบร้อยแล้ว <a href='index.html'>กลับหน้าหลัก</a>\";\r\n?>\r\n"
        }
    ]
}