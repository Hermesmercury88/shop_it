{
    "sourceFile": "generate_pdf.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1758359329030,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758374223699,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,15 +1,19 @@\n <?php\r\n-require 'vendor/autoload.php'; // ถ้าใช้ Composer\r\n+require 'vendor/autoload.php';\r\n use Dompdf\\Dompdf;\r\n \r\n // รับค่าจากฟอร์ม\r\n-$order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n+$order_no = $_POST['order_no'];\r\n $customer = $_POST['customer_name'];\r\n $address = $_POST['customer_address'];\r\n-$items = $_POST['items']; // array\r\n+$item_names = $_POST['item_name'];\r\n+$qtys = $_POST['qty'];\r\n+$units = $_POST['unit'];\r\n+$prices = $_POST['price'];\r\n+$thaiText = $_POST['thaiText'];\r\n \r\n-// สร้าง HTML สำหรับ PDF\r\n+// สร้าง HTML\r\n $html = \"\r\n <h2 style='text-align:center;'>ใบเสร็จรับเงิน</h2>\r\n <p><b>เลขที่ใบสั่งซื้อ (Order No):</b> $order_no</p>\r\n <p><b>ชื่อลูกค้า:</b> $customer</p>\r\n@@ -19,34 +23,37 @@\n         <th>ลำดับ</th>\r\n         <th>รายการ</th>\r\n         <th>จำนวน</th>\r\n         <th>หน่วย</th>\r\n-        <th>ราคา</th>\r\n-        <th>รวม</th>\r\n+        <th>ราคา/หน่วย</th>\r\n+        <th>ราคารวม</th>\r\n     </tr>\r\n \";\r\n \r\n-// ใส่รายการสินค้า\r\n $total = 0;\r\n-foreach ($items as $i => $item) {\r\n-    $sum = $item['qty'] * $item['price'];\r\n+for($i=0; $i<count($item_names); $i++){\r\n+    $sum = $qtys[$i]*$prices[$i];\r\n     $total += $sum;\r\n     $html .= \"\r\n     <tr>\r\n         <td>\".($i+1).\"</td>\r\n-        <td>{$item['name']}</td>\r\n-        <td>{$item['qty']}</td>\r\n-        <td>{$item['unit']}</td>\r\n-        <td>{$item['price']}</td>\r\n-        <td>$sum</td>\r\n+        <td>{$item_names[$i]}</td>\r\n+        <td>{$qtys[$i]}</td>\r\n+        <td>{$units[$i]}</td>\r\n+        <td>\".number_format($prices[$i],2).\"</td>\r\n+        <td>\".number_format($sum,2).\"</td>\r\n     </tr>\";\r\n }\r\n \r\n+// แถวรวม\r\n $html .= \"\r\n-    <tr>\r\n-        <td colspan='5' align='right'><b>รวมทั้งหมด</b></td>\r\n-        <td><b>$total</b></td>\r\n-    </tr>\r\n+<tr>\r\n+    <td colspan='4' style='text-align:center; font-weight:bold; border-top:1px solid #000; border-right:1px solid #000;'>รวมเป็นเงินทั้งสิ้น</td>\r\n+    <td colspan='2' style='text-align:right; font-weight:bold; border-top:1px solid #000;'>\".number_format($total,2).\"</td>\r\n+</tr>\r\n+<tr>\r\n+    <td colspan='6' style='text-align:center; font-weight:bold; padding-top:10px;'>(ตัวอักษร: <b>$thaiText</b>)</td>\r\n+</tr>\r\n </table>\r\n <p style='margin-top:50px;'>ลงชื่อผู้รับเงิน ...........................................</p>\r\n \";\r\n \r\n@@ -55,14 +62,7 @@\n $dompdf->loadHtml($html);\r\n $dompdf->setPaper('A4', 'portrait');\r\n $dompdf->render();\r\n \r\n-// บันทึกเป็นไฟล์\r\n-$output = $dompdf->output();\r\n-$filename = \"receipt_\" . $order_no . \"_\" . time() . \".pdf\"; // ใส่ order_no ในชื่อไฟล์\r\n-file_put_contents(\"receipt_pdfs/$filename\", $output);\r\n-\r\n-// โหลดไฟล์ให้ user ดาวน์โหลด\r\n-header(\"Content-type: application/pdf\");\r\n-header(\"Content-Disposition: inline; filename=$filename\");\r\n-echo $output;\r\n-?>\r\n+// ดาวน์โหลด PDF\r\n+$filename = \"receipt_\" . $order_no . \"_\" . time() . \".pdf\";\r\n+$dompdf->stream($filename, [\"Attachment\" => false]);\r\n"
                },
                {
                    "date": 1758425977461,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,15 +11,49 @@\n $units = $_POST['unit'];\r\n $prices = $_POST['price'];\r\n $thaiText = $_POST['thaiText'];\r\n \r\n-// สร้าง HTML\r\n+// เริ่มสร้าง HTML\r\n $html = \"\r\n+<style>\r\n+    body {\r\n+        font-family: 'DejaVu Sans', sans-serif;\r\n+        font-size: 14px;\r\n+        line-height: 1.5;\r\n+    }\r\n+    h2 {\r\n+        margin: 0;\r\n+        padding: 0;\r\n+    }\r\n+    table {\r\n+        border-collapse: collapse;\r\n+        width: 100%;\r\n+        margin-top: 10px;\r\n+    }\r\n+    th, td {\r\n+        border: 1px solid #000;\r\n+        padding: 6px;\r\n+        font-size: 14px;\r\n+        line-height: 1.4;\r\n+    }\r\n+    th {\r\n+        text-align: center;\r\n+        background: #f0f0f0;\r\n+    }\r\n+    td {\r\n+        vertical-align: middle;\r\n+    }\r\n+    .right { text-align: right; }\r\n+    .center { text-align: center; }\r\n+    .bold { font-weight: bold; }\r\n+</style>\r\n+\r\n <h2 style='text-align:center;'>ใบเสร็จรับเงิน</h2>\r\n <p><b>เลขที่ใบสั่งซื้อ (Order No):</b> $order_no</p>\r\n <p><b>ชื่อลูกค้า:</b> $customer</p>\r\n <p><b>ที่อยู่:</b> $address</p>\r\n-<table border='1' width='100%' cellspacing='0' cellpadding='5'>\r\n+\r\n+<table>\r\n     <tr>\r\n         <th>ลำดับ</th>\r\n         <th>รายการ</th>\r\n         <th>จำนวน</th>\r\n@@ -30,31 +64,32 @@\n \";\r\n \r\n $total = 0;\r\n for($i=0; $i<count($item_names); $i++){\r\n-    $sum = $qtys[$i]*$prices[$i];\r\n+    $sum = $qtys[$i] * $prices[$i];\r\n     $total += $sum;\r\n     $html .= \"\r\n     <tr>\r\n-        <td>\".($i+1).\"</td>\r\n+        <td class='center'>\".($i+1).\"</td>\r\n         <td>{$item_names[$i]}</td>\r\n-        <td>{$qtys[$i]}</td>\r\n-        <td>{$units[$i]}</td>\r\n-        <td>\".number_format($prices[$i],2).\"</td>\r\n-        <td>\".number_format($sum,2).\"</td>\r\n+        <td class='center'>{$qtys[$i]}</td>\r\n+        <td class='center'>{$units[$i]}</td>\r\n+        <td class='right'>\".number_format($prices[$i],2).\"</td>\r\n+        <td class='right'>\".number_format($sum,2).\"</td>\r\n     </tr>\";\r\n }\r\n \r\n // แถวรวม\r\n $html .= \"\r\n <tr>\r\n-    <td colspan='4' style='text-align:center; font-weight:bold; border-top:1px solid #000; border-right:1px solid #000;'>รวมเป็นเงินทั้งสิ้น</td>\r\n-    <td colspan='2' style='text-align:right; font-weight:bold; border-top:1px solid #000;'>\".number_format($total,2).\"</td>\r\n+    <td colspan='4' class='center bold'>รวมเป็นเงินทั้งสิ้น</td>\r\n+    <td colspan='2' class='right bold'>\".number_format($total,2).\"</td>\r\n </tr>\r\n <tr>\r\n     <td colspan='6' style='text-align:center; font-weight:bold; padding-top:10px;'>(ตัวอักษร: <b>$thaiText</b>)</td>\r\n </tr>\r\n </table>\r\n+\r\n <p style='margin-top:50px;'>ลงชื่อผู้รับเงิน ...........................................</p>\r\n \";\r\n \r\n // สร้าง PDF\r\n"
                },
                {
                    "date": 1758430633277,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,53 +2,29 @@\n require 'vendor/autoload.php';\r\n use Dompdf\\Dompdf;\r\n \r\n // รับค่าจากฟอร์ม\r\n-$order_no = $_POST['order_no'];\r\n-$customer = $_POST['customer_name'];\r\n-$address = $_POST['customer_address'];\r\n+$order_no   = $_POST['order_no'];\r\n+$customer   = $_POST['customer_name'];\r\n+$address    = $_POST['customer_address'];\r\n $item_names = $_POST['item_name'];\r\n-$qtys = $_POST['qty'];\r\n-$units = $_POST['unit'];\r\n-$prices = $_POST['price'];\r\n-$thaiText = $_POST['thaiText'];\r\n+$qtys       = $_POST['qty'];\r\n+$units      = $_POST['unit'];\r\n+$prices     = $_POST['price'];\r\n+$thaiText   = $_POST['thaiText'];\r\n \r\n-// เริ่มสร้าง HTML\r\n+// โหลดไฟล์ CSS (ใช้ absolute path หรือ __DIR__)\r\n+$css = file_get_contents(__DIR__ . \"/receipt.css\");\r\n+\r\n+// HTML เนื้อหา\r\n $html = \"\r\n-<style>\r\n-    body {\r\n-        font-family: 'DejaVu Sans', sans-serif;\r\n-        font-size: 14px;\r\n-        line-height: 1.5;\r\n-    }\r\n-    h2 {\r\n-        margin: 0;\r\n-        padding: 0;\r\n-    }\r\n-    table {\r\n-        border-collapse: collapse;\r\n-        width: 100%;\r\n-        margin-top: 10px;\r\n-    }\r\n-    th, td {\r\n-        border: 1px solid #000;\r\n-        padding: 6px;\r\n-        font-size: 14px;\r\n-        line-height: 1.4;\r\n-    }\r\n-    th {\r\n-        text-align: center;\r\n-        background: #f0f0f0;\r\n-    }\r\n-    td {\r\n-        vertical-align: middle;\r\n-    }\r\n-    .right { text-align: right; }\r\n-    .center { text-align: center; }\r\n-    .bold { font-weight: bold; }\r\n-</style>\r\n+<html>\r\n+<head>\r\n+<style>$css</style>\r\n+</head>\r\n+<body>\r\n \r\n-<h2 style='text-align:center;'>ใบเสร็จรับเงิน</h2>\r\n+<h2>ใบเสร็จรับเงิน</h2>\r\n <p><b>เลขที่ใบสั่งซื้อ (Order No):</b> $order_no</p>\r\n <p><b>ชื่อลูกค้า:</b> $customer</p>\r\n <p><b>ที่อยู่:</b> $address</p>\r\n \r\n@@ -62,35 +38,39 @@\n         <th>ราคารวม</th>\r\n     </tr>\r\n \";\r\n \r\n+// คำนวณราคารวม\r\n $total = 0;\r\n-for($i=0; $i<count($item_names); $i++){\r\n+for ($i = 0; $i < count($item_names); $i++) {\r\n     $sum = $qtys[$i] * $prices[$i];\r\n     $total += $sum;\r\n     $html .= \"\r\n     <tr>\r\n         <td class='center'>\".($i+1).\"</td>\r\n         <td>{$item_names[$i]}</td>\r\n         <td class='center'>{$qtys[$i]}</td>\r\n         <td class='center'>{$units[$i]}</td>\r\n-        <td class='right'>\".number_format($prices[$i],2).\"</td>\r\n-        <td class='right'>\".number_format($sum,2).\"</td>\r\n+        <td class='right'>\".number_format($prices[$i], 2).\"</td>\r\n+        <td class='right'>\".number_format($sum, 2).\"</td>\r\n     </tr>\";\r\n }\r\n \r\n // แถวรวม\r\n $html .= \"\r\n <tr>\r\n     <td colspan='4' class='center bold'>รวมเป็นเงินทั้งสิ้น</td>\r\n-    <td colspan='2' class='right bold'>\".number_format($total,2).\"</td>\r\n+    <td colspan='2' class='right bold'>\".number_format($total, 2).\"</td>\r\n </tr>\r\n <tr>\r\n     <td colspan='6' style='text-align:center; font-weight:bold; padding-top:10px;'>(ตัวอักษร: <b>$thaiText</b>)</td>\r\n </tr>\r\n </table>\r\n \r\n <p style='margin-top:50px;'>ลงชื่อผู้รับเงิน ...........................................</p>\r\n+\r\n+</body>\r\n+</html>\r\n \";\r\n \r\n // สร้าง PDF\r\n $dompdf = new Dompdf();\r\n"
                },
                {
                    "date": 1758439823201,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n $address    = $_POST['customer_address'];\r\n $item_names = $_POST['item_name'];\r\n $qtys       = $_POST['qty'];\r\n $units      = $_POST['unit'];\r\n-$prices     = $_POST['price'];\r\n+\r\n $thaiText   = $_POST['thaiText'];\r\n \r\n // โหลดไฟล์ CSS (ใช้ absolute path หรือ __DIR__)\r\n $css = file_get_contents(__DIR__ . \"/receipt.css\");\r\n"
                },
                {
                    "date": 1758439835145,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,10 +7,10 @@\n $customer   = $_POST['customer_name'];\r\n $address    = $_POST['customer_address'];\r\n $item_names = $_POST['item_name'];\r\n $qtys       = $_POST['qty'];\r\n+$prices     = $_POST['price'];\r\n $units      = $_POST['unit'];\r\n-\r\n $thaiText   = $_POST['thaiText'];\r\n \r\n // โหลดไฟล์ CSS (ใช้ absolute path หรือ __DIR__)\r\n $css = file_get_contents(__DIR__ . \"/receipt.css\");\r\n@@ -33,9 +33,9 @@\n         <th>ลำดับ</th>\r\n         <th>รายการ</th>\r\n         <th>จำนวน</th>\r\n         <th>หน่วย</th>\r\n-        <th>ราคา/หน่วย</th>\r\n+        \r\n         <th>ราคารวม</th>\r\n     </tr>\r\n \";\r\n \r\n"
                },
                {
                    "date": 1758439859974,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,10 +32,10 @@\n     <tr>\r\n         <th>ลำดับ</th>\r\n         <th>รายการ</th>\r\n         <th>จำนวน</th>\r\n+        <th>ราคา/หน่วย</th>\r\n         <th>หน่วย</th>\r\n-        \r\n         <th>ราคารวม</th>\r\n     </tr>\r\n \";\r\n \r\n@@ -49,9 +49,9 @@\n         <td class='center'>\".($i+1).\"</td>\r\n         <td>{$item_names[$i]}</td>\r\n         <td class='center'>{$qtys[$i]}</td>\r\n         <td class='center'>{$units[$i]}</td>\r\n-        <td class='right'>\".number_format($prices[$i], 2).\"</td>\r\n+        \r\n         <td class='right'>\".number_format($sum, 2).\"</td>\r\n     </tr>\";\r\n }\r\n \r\n"
                },
                {
                    "date": 1758439865362,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,10 +48,10 @@\n     <tr>\r\n         <td class='center'>\".($i+1).\"</td>\r\n         <td>{$item_names[$i]}</td>\r\n         <td class='center'>{$qtys[$i]}</td>\r\n+        <td class='right'>\".number_format($prices[$i], 2).\"</td>\r\n         <td class='center'>{$units[$i]}</td>\r\n-        \r\n         <td class='right'>\".number_format($sum, 2).\"</td>\r\n     </tr>\";\r\n }\r\n \r\n"
                }
            ],
            "date": 1758359329030,
            "name": "Commit-0",
            "content": "<?php\r\nrequire 'vendor/autoload.php'; // ถ้าใช้ Composer\r\nuse Dompdf\\Dompdf;\r\n\r\n// รับค่าจากฟอร์ม\r\n$order_no = $_POST['order_no']; // เพิ่มตรงนี้\r\n$customer = $_POST['customer_name'];\r\n$address = $_POST['customer_address'];\r\n$items = $_POST['items']; // array\r\n\r\n// สร้าง HTML สำหรับ PDF\r\n$html = \"\r\n<h2 style='text-align:center;'>ใบเสร็จรับเงิน</h2>\r\n<p><b>เลขที่ใบสั่งซื้อ (Order No):</b> $order_no</p>\r\n<p><b>ชื่อลูกค้า:</b> $customer</p>\r\n<p><b>ที่อยู่:</b> $address</p>\r\n<table border='1' width='100%' cellspacing='0' cellpadding='5'>\r\n    <tr>\r\n        <th>ลำดับ</th>\r\n        <th>รายการ</th>\r\n        <th>จำนวน</th>\r\n        <th>หน่วย</th>\r\n        <th>ราคา</th>\r\n        <th>รวม</th>\r\n    </tr>\r\n\";\r\n\r\n// ใส่รายการสินค้า\r\n$total = 0;\r\nforeach ($items as $i => $item) {\r\n    $sum = $item['qty'] * $item['price'];\r\n    $total += $sum;\r\n    $html .= \"\r\n    <tr>\r\n        <td>\".($i+1).\"</td>\r\n        <td>{$item['name']}</td>\r\n        <td>{$item['qty']}</td>\r\n        <td>{$item['unit']}</td>\r\n        <td>{$item['price']}</td>\r\n        <td>$sum</td>\r\n    </tr>\";\r\n}\r\n\r\n$html .= \"\r\n    <tr>\r\n        <td colspan='5' align='right'><b>รวมทั้งหมด</b></td>\r\n        <td><b>$total</b></td>\r\n    </tr>\r\n</table>\r\n<p style='margin-top:50px;'>ลงชื่อผู้รับเงิน ...........................................</p>\r\n\";\r\n\r\n// สร้าง PDF\r\n$dompdf = new Dompdf();\r\n$dompdf->loadHtml($html);\r\n$dompdf->setPaper('A4', 'portrait');\r\n$dompdf->render();\r\n\r\n// บันทึกเป็นไฟล์\r\n$output = $dompdf->output();\r\n$filename = \"receipt_\" . $order_no . \"_\" . time() . \".pdf\"; // ใส่ order_no ในชื่อไฟล์\r\nfile_put_contents(\"receipt_pdfs/$filename\", $output);\r\n\r\n// โหลดไฟล์ให้ user ดาวน์โหลด\r\nheader(\"Content-type: application/pdf\");\r\nheader(\"Content-Disposition: inline; filename=$filename\");\r\necho $output;\r\n?>\r\n"
        }
    ]
}