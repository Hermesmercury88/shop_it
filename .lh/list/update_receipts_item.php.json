{
    "sourceFile": "list/update_receipts_item.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1758612515666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758612743624,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,54 +1,47 @@\n <?php\r\n-header('Content-Type: application/json');\r\n+header(\"Content-Type: application/json\");\r\n+$conn = new mysqli(\"localhost\",\"root\",\"\",\"shop_it\");\r\n \r\n-// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n-$host=\"localhost\";\r\n-$user=\"root\";\r\n-$pass=\"\";\r\n-$dbname=\"shop_it\";\r\n-\r\n-$conn=new mysqli($host,$user,$pass,$dbname);\r\n-if($conn->connect_error){\r\n-    echo json_encode(['success'=>false,'msg'=>'‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß']);\r\n+if ($conn->connect_error) {\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\"]);\r\n     exit;\r\n }\r\n \r\n-// ‡∏£‡∏±‡∏ö JSON ‡∏à‡∏≤‡∏Å fetch\r\n-$data = json_decode(file_get_contents('php://input'), true);\r\n+$data = json_decode(file_get_contents(\"php://input\"), true);\r\n+$id = intval($data['id'] ?? 0);\r\n+$fields = $data['data'] ?? [];\r\n \r\n-if(!isset($data['id']) || !isset($data['data'])){\r\n-    echo json_encode(['success'=>false,'msg'=>'‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö']);\r\n+if ($id <= 0 || !$fields) {\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"]);\r\n     exit;\r\n }\r\n \r\n-$id = intval($data['id']);\r\n-$item = $data['data'];\r\n+// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total\r\n+$fields['total'] = floatval($fields['qty']) * floatval($fields['price']);\r\n \r\n-// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total\r\n-$qty = floatval($item['qty'] ?? 0);\r\n-$price = floatval($item['price'] ?? 0);\r\n-$total = $qty * $price;\r\n-\r\n-// ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SQL (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô receipt_items)\r\n-$sql = \"UPDATE receipt_items SET \r\n-        qty=?, price=?, total=?, item_name=?, unit=?\r\n+$sql = \"UPDATE receipt_items SET\r\n+        order_no=?, customer_name=?, customer_address=?,\r\n+        item_name=?, qty=?, price=?, unit=?, total=?\r\n         WHERE id=?\";\r\n $stmt = $conn->prepare($sql);\r\n $stmt->bind_param(\r\n-    \"ddsssi\",\r\n-    $qty,\r\n-    $price,\r\n-    $total,\r\n-    $item['item_name'],\r\n-    $item['unit'],\r\n+    \"sssssiddi\",\r\n+    $fields['order_no'],\r\n+    $fields['customer_name'],\r\n+    $fields['customer_address'],\r\n+    $fields['item_name'],\r\n+    $fields['qty'],\r\n+    $fields['price'],\r\n+    $fields['unit'],\r\n+    $fields['total'],\r\n     $id\r\n );\r\n \r\n if($stmt->execute()){\r\n-    echo json_encode(['success'=>true]);\r\n-} else {\r\n-    echo json_encode(['success'=>false,'msg'=>$stmt->error]);\r\n+    echo json_encode([\"success\"=>true]);\r\n+}else{\r\n+    echo json_encode([\"success\"=>false,\"message\"=>$stmt->error]);\r\n }\r\n $stmt->close();\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1758612991387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,30 +1,29 @@\n <?php\r\n header(\"Content-Type: application/json\");\r\n $conn = new mysqli(\"localhost\",\"root\",\"\",\"shop_it\");\r\n \r\n-if ($conn->connect_error) {\r\n+if($conn->connect_error){\r\n     echo json_encode([\"success\"=>false,\"message\"=>\"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\"]);\r\n     exit;\r\n }\r\n \r\n-$data = json_decode(file_get_contents(\"php://input\"), true);\r\n-$id = intval($data['id'] ?? 0);\r\n-$fields = $data['data'] ?? [];\r\n+$data=json_decode(file_get_contents(\"php://input\"),true);\r\n+$id=intval($data['id'] ?? 0);\r\n+$fields=$data['data'] ?? [];\r\n \r\n-if ($id <= 0 || !$fields) {\r\n+if($id<=0 || !$fields){\r\n     echo json_encode([\"success\"=>false,\"message\"=>\"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"]);\r\n     exit;\r\n }\r\n \r\n-// ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total\r\n-$fields['total'] = floatval($fields['qty']) * floatval($fields['price']);\r\n+$fields['total']=floatval($fields['qty'])*floatval($fields['price']);\r\n \r\n-$sql = \"UPDATE receipt_items SET\r\n+$sql=\"UPDATE receipt_items SET \r\n         order_no=?, customer_name=?, customer_address=?,\r\n-        item_name=?, qty=?, price=?, unit=?, total=?\r\n-        WHERE id=?\";\r\n-$stmt = $conn->prepare($sql);\r\n+        item_name=?, qty=?, price=?, unit=?, total=? \r\n+      WHERE id=?\";\r\n+$stmt=$conn->prepare($sql);\r\n $stmt->bind_param(\r\n     \"sssssiddi\",\r\n     $fields['order_no'],\r\n     $fields['customer_name'],\r\n@@ -36,12 +35,10 @@\n     $fields['total'],\r\n     $id\r\n );\r\n \r\n-if($stmt->execute()){\r\n-    echo json_encode([\"success\"=>true]);\r\n-}else{\r\n-    echo json_encode([\"success\"=>false,\"message\"=>$stmt->error]);\r\n-}\r\n+if($stmt->execute()) echo json_encode([\"success\"=>true]);\r\n+else echo json_encode([\"success\"=>false,\"message\"=>$stmt->error]);\r\n+\r\n $stmt->close();\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1758613478304,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,44 +1,42 @@\n <?php\r\n header(\"Content-Type: application/json\");\r\n-$conn = new mysqli(\"localhost\",\"root\",\"\",\"shop_it\");\r\n \r\n+$host = \"localhost\";\r\n+$user = \"root\";\r\n+$pass = \"\";\r\n+$dbname = \"shop_it\";\r\n+\r\n+$conn = new mysqli($host,$user,$pass,$dbname);\r\n if($conn->connect_error){\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\"]);\r\n-    exit;\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ DB ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\"]); exit;\r\n }\r\n \r\n-$data=json_decode(file_get_contents(\"php://input\"),true);\r\n-$id=intval($data['id'] ?? 0);\r\n-$fields=$data['data'] ?? [];\r\n+$data = json_decode(file_get_contents(\"php://input\"),true);\r\n \r\n-if($id<=0 || !$fields){\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"]);\r\n-    exit;\r\n+$id = isset($data['id']) ? intval($data['id']) : 0;\r\n+$order_no = $data['order_no'] ?? '';\r\n+$customer_name = $data['customer_name'] ?? '';\r\n+$customer_address = $data['customer_address'] ?? '';\r\n+$item_name = $data['item_name'] ?? '';\r\n+$qty = isset($data['qty']) ? floatval($data['qty']) : 0;\r\n+$price = isset($data['price']) ? floatval($data['price']) : 0;\r\n+$unit = $data['unit'] ?? '';\r\n+$total = $qty * $price;\r\n+\r\n+if($id<=0){\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"]); exit;\r\n }\r\n \r\n-$fields['total']=floatval($fields['qty'])*floatval($fields['price']);\r\n-\r\n-$sql=\"UPDATE receipt_items SET \r\n-        order_no=?, customer_name=?, customer_address=?,\r\n-        item_name=?, qty=?, price=?, unit=?, total=? \r\n-      WHERE id=?\";\r\n+$sql = \"UPDATE receipt_items SET item_name=?, qty=?, price=?, unit=?, total=? WHERE id=?\";\r\n $stmt=$conn->prepare($sql);\r\n-$stmt->bind_param(\r\n-    \"sssssiddi\",\r\n-    $fields['order_no'],\r\n-    $fields['customer_name'],\r\n-    $fields['customer_address'],\r\n-    $fields['item_name'],\r\n-    $fields['qty'],\r\n-    $fields['price'],\r\n-    $fields['unit'],\r\n-    $fields['total'],\r\n-    $id\r\n-);\r\n+$stmt->bind_param(\"sddssi\",$item_name,$qty,$price,$unit,$total,$id);\r\n \r\n-if($stmt->execute()) echo json_encode([\"success\"=>true]);\r\n-else echo json_encode([\"success\"=>false,\"message\"=>$stmt->error]);\r\n+if($stmt->execute()){\r\n+    echo json_encode([\"success\"=>true]);\r\n+}else{\r\n+    echo json_encode([\"success\"=>false,\"message\"=>$stmt->error]);\r\n+}\r\n \r\n $stmt->close();\r\n $conn->close();\r\n ?>\r\n"
                },
                {
                    "date": 1758639779516,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,42 +1,76 @@\n <?php\r\n header(\"Content-Type: application/json\");\r\n \r\n+// üîπ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+$dbname = \"shop_it2\";\r\n \r\n-$conn = new mysqli($host,$user,$pass,$dbname);\r\n-if($conn->connect_error){\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ DB ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\"]); exit;\r\n+// üîπ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠\r\n+$conn = new mysqli($host, $user, $pass, $dbname);\r\n+if ($conn->connect_error) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß\"]);\r\n+    exit;\r\n }\r\n \r\n-$data = json_decode(file_get_contents(\"php://input\"),true);\r\n+// üîπ ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å frontend\r\n+$data = json_decode(file_get_contents(\"php://input\"), true);\r\n+$id   = $data[\"id\"] ?? null;\r\n+$vals = $data[\"data\"] ?? [];\r\n \r\n-$id = isset($data['id']) ? intval($data['id']) : 0;\r\n-$order_no = $data['order_no'] ?? '';\r\n-$customer_name = $data['customer_name'] ?? '';\r\n-$customer_address = $data['customer_address'] ?? '';\r\n-$item_name = $data['item_name'] ?? '';\r\n-$qty = isset($data['qty']) ? floatval($data['qty']) : 0;\r\n-$price = isset($data['price']) ? floatval($data['price']) : 0;\r\n-$unit = $data['unit'] ?? '';\r\n-$total = $qty * $price;\r\n+if (!$id || count($vals) < 8) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö\"]);\r\n+    exit;\r\n+}\r\n \r\n-if($id<=0){\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"ID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"]); exit;\r\n+// üîπ Map ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° column ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ all_receipts1.php)\r\n+$order_no        = $vals[0];\r\n+$customer_name   = $vals[1];\r\n+$customer_address= $vals[2];\r\n+$item_name       = $vals[3];\r\n+$qty             = $vals[4];\r\n+$price           = $vals[5];\r\n+$unit            = $vals[6];\r\n+$total           = $vals[7];\r\n+\r\n+// üîπ Update receipt_items\r\n+$sql_item = \"UPDATE receipt_items \r\n+             SET item_name=?, qty=?, price=?, unit=?, total=? \r\n+             WHERE id=?\";\r\n+$stmt_item = $conn->prepare($sql_item);\r\n+if (!$stmt_item) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° statement item ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ\"]);\r\n+    exit;\r\n }\r\n+$stmt_item->bind_param(\"sidssi\", $item_name, $qty, $price, $unit, $total, $id);\r\n \r\n-$sql = \"UPDATE receipt_items SET item_name=?, qty=?, price=?, unit=?, total=? WHERE id=?\";\r\n-$stmt=$conn->prepare($sql);\r\n-$stmt->bind_param(\"sddssi\",$item_name,$qty,$price,$unit,$total,$id);\r\n+// üîπ Update receipts (‡πÉ‡∏ä‡πâ subquery ‡∏´‡∏≤ receipt_id ‡∏à‡∏≤‡∏Å item id)\r\n+$sql_main = \"UPDATE receipts \r\n+             SET order_no=?, customer_name=?, customer_address=? \r\n+             WHERE id=(SELECT receipt_id FROM receipt_items WHERE id=?)\";\r\n+$stmt_main = $conn->prepare($sql_main);\r\n+if (!$stmt_main) {\r\n+    echo json_encode([\"success\" => false, \"message\" => \"‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° statement main ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ\"]);\r\n+    exit;\r\n+}\r\n+$stmt_main->bind_param(\"sssi\", $order_no, $customer_name, $customer_address, $id);\r\n \r\n-if($stmt->execute()){\r\n-    echo json_encode([\"success\"=>true]);\r\n-}else{\r\n-    echo json_encode([\"success\"=>false,\"message\"=>$stmt->error]);\r\n+// üîπ Execute\r\n+$success = $stmt_item->execute() && $stmt_main->execute();\r\n+\r\n+if ($success) {\r\n+    echo json_encode([\"success\" => true]);\r\n+} else {\r\n+    echo json_encode([\r\n+        \"success\" => false,\r\n+        \"message\" => \"‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\",\r\n+        \"error_item\" => $stmt_item->error,\r\n+        \"error_main\" => $stmt_main->error\r\n+    ]);\r\n }\r\n \r\n-$stmt->close();\r\n+$stmt_item->close();\r\n+$stmt_main->close();\r\n $conn->close();\r\n ?>\r\n"
                }
            ],
            "date": 1758612515666,
            "name": "Commit-0",
            "content": "<?php\r\nheader('Content-Type: application/json');\r\n\r\n// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n$host=\"localhost\";\r\n$user=\"root\";\r\n$pass=\"\";\r\n$dbname=\"shop_it\";\r\n\r\n$conn=new mysqli($host,$user,$pass,$dbname);\r\nif($conn->connect_error){\r\n    echo json_encode(['success'=>false,'msg'=>'‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß']);\r\n    exit;\r\n}\r\n\r\n// ‡∏£‡∏±‡∏ö JSON ‡∏à‡∏≤‡∏Å fetch\r\n$data = json_decode(file_get_contents('php://input'), true);\r\n\r\nif(!isset($data['id']) || !isset($data['data'])){\r\n    echo json_encode(['success'=>false,'msg'=>'‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö']);\r\n    exit;\r\n}\r\n\r\n$id = intval($data['id']);\r\n$item = $data['data'];\r\n\r\n// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total\r\n$qty = floatval($item['qty'] ?? 0);\r\n$price = floatval($item['price'] ?? 0);\r\n$total = $qty * $price;\r\n\r\n// ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SQL (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô receipt_items)\r\n$sql = \"UPDATE receipt_items SET \r\n        qty=?, price=?, total=?, item_name=?, unit=?\r\n        WHERE id=?\";\r\n$stmt = $conn->prepare($sql);\r\n$stmt->bind_param(\r\n    \"ddsssi\",\r\n    $qty,\r\n    $price,\r\n    $total,\r\n    $item['item_name'],\r\n    $item['unit'],\r\n    $id\r\n);\r\n\r\nif($stmt->execute()){\r\n    echo json_encode(['success'=>true]);\r\n} else {\r\n    echo json_encode(['success'=>false,'msg'=>$stmt->error]);\r\n}\r\n$stmt->close();\r\n$conn->close();\r\n?>\r\n"
        }
    ]
}