{
    "sourceFile": "list/update_delivery_item.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 15,
            "patches": [
                {
                    "date": 1758604445389,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758637063755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n+$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n+$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637097990,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n-$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n+$qty           = floatval($values[3]);\r\n+$price         = floatval($values[4]);\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n+$total         = floatval($values[6]);\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n+        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637250531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n+$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n+$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637273427,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n-$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n+$qty           = floatval($values[3]);\r\n+$price         = floatval($values[4]);\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n+$total         = floatval($values[6]);\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n+        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637354153,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n+$qty           = $conn->real_escape_string($values[3]);   // <-- รับเป็น string\r\n+$price         = $conn->real_escape_string($values[4]);   // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758638147805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,10 +19,11 @@\n $item_name     = $conn->real_escape_string($values[2]);\r\n $qty           = $conn->real_escape_string($values[3]);   // <-- รับเป็น string\r\n $price         = $conn->real_escape_string($values[4]);   // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n+$total = $conn->real_escape_string($values[6]); // เก็บเป็น string\r\n \r\n+\r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n         SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n"
                },
                {
                    "date": 1758715910924,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,30 +13,33 @@\n $id = intval($data['id']);\r\n $values = $data['data'];\r\n \r\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n-$customer_name = $conn->real_escape_string($values[0]);\r\n-$delivery_no   = $conn->real_escape_string($values[1]);\r\n-$item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = $conn->real_escape_string($values[3]);   // <-- รับเป็น string\r\n-$price         = $conn->real_escape_string($values[4]);   // <-- รับเป็น string\r\n-$unit          = $conn->real_escape_string($values[5]);\r\n-$total = $conn->real_escape_string($values[6]); // เก็บเป็น string\r\n+$customer_name = $values[0] ?? '';\r\n+$delivery_no   = $values[1] ?? '';\r\n+$item_name     = $values[2] ?? '';\r\n+$qty           = floatval($values[3] ?? 0);\r\n+$price         = floatval($values[4] ?? 0);\r\n+$unit          = $values[5] ?? '';\r\n+$total         = floatval($values[6] ?? 0);\r\n \r\n-\r\n // อัปเดตตาราง delivery_items\r\n-$sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n-        WHERE id=$id\";\r\n+$stmt1 = $conn->prepare(\"UPDATE delivery_items SET item_name=?, qty=?, price=?, unit=?, total=? WHERE id=?\");\r\n+$stmt1->bind_param(\"sddsdi\", $item_name, $qty, $price, $unit, $total, $id);\r\n \r\n-// อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n-$sql2 = \"UPDATE deliveries d\r\n-         JOIN delivery_items i ON i.delivery_id = d.id\r\n-         SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n-         WHERE i.id=$id\";\r\n+// อัปเดตตาราง deliveries (customer_name, delivery_no)\r\n+$stmt2 = $conn->prepare(\"UPDATE deliveries d\r\n+                         JOIN delivery_items i ON i.delivery_id = d.id\r\n+                         SET d.customer_name=?, d.delivery_no=?\r\n+                         WHERE i.id=?\");\r\n+$stmt2->bind_param(\"ssi\", $customer_name, $delivery_no, $id);\r\n \r\n-if ($conn->query($sql) && $conn->query($sql2)) {\r\n+if ($stmt1->execute() && $stmt2->execute()) {\r\n     echo json_encode([\"success\" => true]);\r\n } else {\r\n     echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n+\r\n+$stmt1->close();\r\n+$stmt2->close();\r\n $conn->close();\r\n+?>\r\n"
                },
                {
                    "date": 1758716125583,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,33 +13,29 @@\n $id = intval($data['id']);\r\n $values = $data['data'];\r\n \r\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n-$customer_name = $values[0] ?? '';\r\n-$delivery_no   = $values[1] ?? '';\r\n-$item_name     = $values[2] ?? '';\r\n-$qty           = floatval($values[3] ?? 0);\r\n-$price         = floatval($values[4] ?? 0);\r\n-$unit          = $values[5] ?? '';\r\n-$total         = floatval($values[6] ?? 0);\r\n+$customer_name = $conn->real_escape_string($values[0]);\r\n+$delivery_no   = $conn->real_escape_string($values[1]);\r\n+$item_name     = $conn->real_escape_string($values[2]);\r\n+$qty           = floatval($values[3]);\r\n+$price         = floatval($values[4]);\r\n+$unit          = $conn->real_escape_string($values[5]);\r\n+$total         = floatval($values[6]);\r\n \r\n // อัปเดตตาราง delivery_items\r\n-$stmt1 = $conn->prepare(\"UPDATE delivery_items SET item_name=?, qty=?, price=?, unit=?, total=? WHERE id=?\");\r\n-$stmt1->bind_param(\"sddsdi\", $item_name, $qty, $price, $unit, $total, $id);\r\n+$sql = \"UPDATE delivery_items \r\n+        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        WHERE id=$id\";\r\n \r\n-// อัปเดตตาราง deliveries (customer_name, delivery_no)\r\n-$stmt2 = $conn->prepare(\"UPDATE deliveries d\r\n-                         JOIN delivery_items i ON i.delivery_id = d.id\r\n-                         SET d.customer_name=?, d.delivery_no=?\r\n-                         WHERE i.id=?\");\r\n-$stmt2->bind_param(\"ssi\", $customer_name, $delivery_no, $id);\r\n+// อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n+$sql2 = \"UPDATE deliveries d\r\n+         JOIN delivery_items i ON i.delivery_id = d.id\r\n+         SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n+         WHERE i.id=$id\";\r\n \r\n-if ($stmt1->execute() && $stmt2->execute()) {\r\n+if ($conn->query($sql) && $conn->query($sql2)) {\r\n     echo json_encode([\"success\" => true]);\r\n } else {\r\n     echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n-\r\n-$stmt1->close();\r\n-$stmt2->close();\r\n $conn->close();\r\n-?>\r\n"
                },
                {
                    "date": 1758718225429,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,10 +32,27 @@\n          JOIN delivery_items i ON i.delivery_id = d.id\r\n          SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n          WHERE i.id=$id\";\r\n \r\n-if ($conn->query($sql) && $conn->query($sql2)) {\r\n+// ถ้ามี pdf_file ส่งมาด้วย ให้รองรับอัปเดต\r\n+if (isset($data['pdf_file']) && !empty($data['pdf_file'])) {\r\n+    $pdf_file = $conn->real_escape_string($data['pdf_file']);\r\n+    $sql3 = \"UPDATE deliveries \r\n+             SET pdf_file='$pdf_file'\r\n+             WHERE id = (SELECT delivery_id FROM delivery_items WHERE id=$id)\";\r\n+} else {\r\n+    $sql3 = null;\r\n+}\r\n+\r\n+// Execute\r\n+$success = $conn->query($sql) && $conn->query($sql2);\r\n+if ($sql3) {\r\n+    $success = $success && $conn->query($sql3);\r\n+}\r\n+\r\n+if ($success) {\r\n     echo json_encode([\"success\" => true]);\r\n } else {\r\n     echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n+\r\n $conn->close();\r\n"
                },
                {
                    "date": 1758718757532,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,58 +1,46 @@\n <?php\r\n-$host = \"localhost\";\r\n-$user = \"root\";\r\n-$pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+$host=\"localhost\";\r\n+$user=\"root\";\r\n+$pass=\"\";\r\n+$dbname=\"shop_it\";\r\n \r\n-$conn = new mysqli($host, $user, $pass, $dbname);\r\n-if ($conn->connect_error) {\r\n-    die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n+$conn = new mysqli($host,$user,$pass,$dbname);\r\n+if($conn->connect_error){\r\n+    die(json_encode([\"success\"=>false,\"message\"=>\"เชื่อมต่อ DB ล้มเหลว\"]));\r\n }\r\n \r\n-$data = json_decode(file_get_contents(\"php://input\"), true);\r\n-$id = intval($data['id']);\r\n-$values = $data['data'];\r\n+if(!isset($_POST['delivery_id']) || !isset($_FILES['pdf_file'])){\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"ข้อมูลไม่ครบ\"]);\r\n+    exit;\r\n+}\r\n \r\n-// data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n-$customer_name = $conn->real_escape_string($values[0]);\r\n-$delivery_no   = $conn->real_escape_string($values[1]);\r\n-$item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n-$unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$delivery_id = intval($_POST['delivery_id']);\r\n+$file = $_FILES['pdf_file'];\r\n \r\n-// อัปเดตตาราง delivery_items\r\n-$sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n-        WHERE id=$id\";\r\n+$ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));\r\n+if($ext != \"pdf\"){\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"ไฟล์ต้องเป็น PDF\"]);\r\n+    exit;\r\n+}\r\n \r\n-// อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n-$sql2 = \"UPDATE deliveries d\r\n-         JOIN delivery_items i ON i.delivery_id = d.id\r\n-         SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n-         WHERE i.id=$id\";\r\n+$uploadDir = \"../uploads/deliveries/\";\r\n+if(!is_dir($uploadDir)) mkdir($uploadDir,0777,true);\r\n \r\n-// ถ้ามี pdf_file ส่งมาด้วย ให้รองรับอัปเดต\r\n-if (isset($data['pdf_file']) && !empty($data['pdf_file'])) {\r\n-    $pdf_file = $conn->real_escape_string($data['pdf_file']);\r\n-    $sql3 = \"UPDATE deliveries \r\n-             SET pdf_file='$pdf_file'\r\n-             WHERE id = (SELECT delivery_id FROM delivery_items WHERE id=$id)\";\r\n-} else {\r\n-    $sql3 = null;\r\n-}\r\n+$newFileName = \"delivery\".$delivery_id.\"_\".time().\".pdf\";\r\n+$uploadPath = $uploadDir . $newFileName;\r\n \r\n-// Execute\r\n-$success = $conn->query($sql) && $conn->query($sql2);\r\n-if ($sql3) {\r\n-    $success = $success && $conn->query($sql3);\r\n-}\r\n-\r\n-if ($success) {\r\n-    echo json_encode([\"success\" => true]);\r\n+if(move_uploaded_file($file['tmp_name'],$uploadPath)){\r\n+    $stmt = $conn->prepare(\"UPDATE deliveries SET pdf_file=? WHERE id=?\");\r\n+    $stmt->bind_param(\"si\", $newFileName, $delivery_id);\r\n+    if($stmt->execute()){\r\n+        echo json_encode([\"success\"=>true, \"pdf_file\"=>$newFileName]);\r\n+    } else {\r\n+        echo json_encode([\"success\"=>false,\"message\"=>\"อัปเดตฐานข้อมูลล้มเหลว\"]);\r\n+    }\r\n+    $stmt->close();\r\n } else {\r\n-    echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n+    echo json_encode([\"success\"=>false,\"message\"=>\"อัปโหลดไฟล์ล้มเหลว\"]);\r\n }\r\n \r\n $conn->close();\r\n+?>\r\n"
                },
                {
                    "date": 1758718764773,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,46 +1,58 @@\n <?php\r\n-$host=\"localhost\";\r\n-$user=\"root\";\r\n-$pass=\"\";\r\n-$dbname=\"shop_it\";\r\n+$host = \"localhost\";\r\n+$user = \"root\";\r\n+$pass = \"\";\r\n+$dbname = \"shop_it\";\r\n \r\n-$conn = new mysqli($host,$user,$pass,$dbname);\r\n-if($conn->connect_error){\r\n-    die(json_encode([\"success\"=>false,\"message\"=>\"เชื่อมต่อ DB ล้มเหลว\"]));\r\n+$conn = new mysqli($host, $user, $pass, $dbname);\r\n+if ($conn->connect_error) {\r\n+    die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n }\r\n \r\n-if(!isset($_POST['delivery_id']) || !isset($_FILES['pdf_file'])){\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"ข้อมูลไม่ครบ\"]);\r\n-    exit;\r\n-}\r\n+$data = json_decode(file_get_contents(\"php://input\"), true);\r\n+$id = intval($data['id']);\r\n+$values = $data['data'];\r\n \r\n-$delivery_id = intval($_POST['delivery_id']);\r\n-$file = $_FILES['pdf_file'];\r\n+// data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n+$customer_name = $conn->real_escape_string($values[0]);\r\n+$delivery_no   = $conn->real_escape_string($values[1]);\r\n+$item_name     = $conn->real_escape_string($values[2]);\r\n+$qty           = floatval($values[3]);\r\n+$price         = floatval($values[4]);\r\n+$unit          = $conn->real_escape_string($values[5]);\r\n+$total         = floatval($values[6]);\r\n \r\n-$ext = strtolower(pathinfo($file['name'], PATHINFO_EXTENSION));\r\n-if($ext != \"pdf\"){\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"ไฟล์ต้องเป็น PDF\"]);\r\n-    exit;\r\n+// อัปเดตตาราง delivery_items\r\n+$sql = \"UPDATE delivery_items \r\n+        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        WHERE id=$id\";\r\n+\r\n+// อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n+$sql2 = \"UPDATE deliveries d\r\n+         JOIN delivery_items i ON i.delivery_id = d.id\r\n+         SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n+         WHERE i.id=$id\";\r\n+\r\n+// ถ้ามี pdf_file ส่งมาด้วย ให้รองรับอัปเดต\r\n+if (isset($data['pdf_file']) && !empty($data['pdf_file'])) {\r\n+    $pdf_file = $conn->real_escape_string($data['pdf_file']);\r\n+    $sql3 = \"UPDATE deliveries \r\n+             SET pdf_file='$pdf_file'\r\n+             WHERE id = (SELECT delivery_id FROM delivery_items WHERE id=$id)\";\r\n+} else {\r\n+    $sql3 = null;\r\n }\r\n \r\n-$uploadDir = \"../uploads/deliveries/\";\r\n-if(!is_dir($uploadDir)) mkdir($uploadDir,0777,true);\r\n+// Execute\r\n+$success = $conn->query($sql) && $conn->query($sql2);\r\n+if ($sql3) {\r\n+    $success = $success && $conn->query($sql3);\r\n+}\r\n \r\n-$newFileName = \"delivery\".$delivery_id.\"_\".time().\".pdf\";\r\n-$uploadPath = $uploadDir . $newFileName;\r\n-\r\n-if(move_uploaded_file($file['tmp_name'],$uploadPath)){\r\n-    $stmt = $conn->prepare(\"UPDATE deliveries SET pdf_file=? WHERE id=?\");\r\n-    $stmt->bind_param(\"si\", $newFileName, $delivery_id);\r\n-    if($stmt->execute()){\r\n-        echo json_encode([\"success\"=>true, \"pdf_file\"=>$newFileName]);\r\n-    } else {\r\n-        echo json_encode([\"success\"=>false,\"message\"=>\"อัปเดตฐานข้อมูลล้มเหลว\"]);\r\n-    }\r\n-    $stmt->close();\r\n+if ($success) {\r\n+    echo json_encode([\"success\" => true]);\r\n } else {\r\n-    echo json_encode([\"success\"=>false,\"message\"=>\"อัปโหลดไฟล์ล้มเหลว\"]);\r\n+    echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n \r\n $conn->close();\r\n-?>\r\n"
                },
                {
                    "date": 1758718923242,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+$dbname = \"shop_it2\";\r\n \r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n     die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n@@ -32,27 +32,10 @@\n          JOIN delivery_items i ON i.delivery_id = d.id\r\n          SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n          WHERE i.id=$id\";\r\n \r\n-// ถ้ามี pdf_file ส่งมาด้วย ให้รองรับอัปเดต\r\n-if (isset($data['pdf_file']) && !empty($data['pdf_file'])) {\r\n-    $pdf_file = $conn->real_escape_string($data['pdf_file']);\r\n-    $sql3 = \"UPDATE deliveries \r\n-             SET pdf_file='$pdf_file'\r\n-             WHERE id = (SELECT delivery_id FROM delivery_items WHERE id=$id)\";\r\n-} else {\r\n-    $sql3 = null;\r\n-}\r\n-\r\n-// Execute\r\n-$success = $conn->query($sql) && $conn->query($sql2);\r\n-if ($sql3) {\r\n-    $success = $success && $conn->query($sql3);\r\n-}\r\n-\r\n-if ($success) {\r\n+if ($conn->query($sql) && $conn->query($sql2)) {\r\n     echo json_encode([\"success\" => true]);\r\n } else {\r\n     echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n-\r\n $conn->close();\r\n"
                },
                {
                    "date": 1758728347361,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it2\";\r\n+$dbname = \"shop_it\";\r\n \r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n     die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n"
                },
                {
                    "date": 1758728974649,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -37,5 +37,5 @@\n     echo json_encode([\"success\" => true]);\r\n } else {\r\n     echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n-$conn->close();\r\n+$conn->close();\n\\ No newline at end of file\n"
                },
                {
                    "date": 1758729048524,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <?php\r\n $host = \"localhost\";\r\n $user = \"root\";\r\n $pass = \"\";\r\n-$dbname = \"shop_it\";\r\n+$dbname = \"shop_it2\";\r\n \r\n $conn = new mysqli($host, $user, $pass, $dbname);\r\n if ($conn->connect_error) {\r\n     die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n@@ -37,5 +37,5 @@\n     echo json_encode([\"success\" => true]);\r\n } else {\r\n     echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n }\r\n-$conn->close();\n\\ No newline at end of file\n+$conn->close();\r\n"
                }
            ],
            "date": 1758604445389,
            "name": "Commit-0",
            "content": "<?php\r\n$host = \"localhost\";\r\n$user = \"root\";\r\n$pass = \"\";\r\n$dbname = \"shop_it\";\r\n\r\n$conn = new mysqli($host, $user, $pass, $dbname);\r\nif ($conn->connect_error) {\r\n    die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n}\r\n\r\n$data = json_decode(file_get_contents(\"php://input\"), true);\r\n$id = intval($data['id']);\r\n$values = $data['data'];\r\n\r\n// data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n$customer_name = $conn->real_escape_string($values[0]);\r\n$delivery_no   = $conn->real_escape_string($values[1]);\r\n$item_name     = $conn->real_escape_string($values[2]);\r\n$qty           = floatval($values[3]);\r\n$price         = floatval($values[4]);\r\n$unit          = $conn->real_escape_string($values[5]);\r\n$total         = floatval($values[6]);\r\n\r\n// อัปเดตตาราง delivery_items\r\n$sql = \"UPDATE delivery_items \r\n        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n        WHERE id=$id\";\r\n\r\n// อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n$sql2 = \"UPDATE deliveries d\r\n         JOIN delivery_items i ON i.delivery_id = d.id\r\n         SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n         WHERE i.id=$id\";\r\n\r\nif ($conn->query($sql) && $conn->query($sql2)) {\r\n    echo json_encode([\"success\" => true]);\r\n} else {\r\n    echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n}\r\n$conn->close();\r\n"
        }
    ]
}