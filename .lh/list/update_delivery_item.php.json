{
    "sourceFile": "list/update_delivery_item.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1758604445389,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1758637063755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n+$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n+$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637097990,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n-$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n+$qty           = floatval($values[3]);\r\n+$price         = floatval($values[4]);\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n+$total         = floatval($values[6]);\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n+        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637250531,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n+$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n+$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637273427,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = $conn->real_escape_string($values[3]);    // <-- รับเป็น string\r\n-$price         = $conn->real_escape_string($values[4]);    // <-- รับเป็น string\r\n+$qty           = floatval($values[3]);\r\n+$price         = floatval($values[4]);\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n+$total         = floatval($values[6]);\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n+        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758637354153,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,16 +16,16 @@\n // data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n $customer_name = $conn->real_escape_string($values[0]);\r\n $delivery_no   = $conn->real_escape_string($values[1]);\r\n $item_name     = $conn->real_escape_string($values[2]);\r\n-$qty           = floatval($values[3]);\r\n-$price         = floatval($values[4]);\r\n+$qty           = $conn->real_escape_string($values[3]);   // <-- รับเป็น string\r\n+$price         = $conn->real_escape_string($values[4]);   // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = floatval($values[6]);\r\n+$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n \r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n-        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n+        SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n \r\n // อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n $sql2 = \"UPDATE deliveries d\r\n"
                },
                {
                    "date": 1758638147805,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,10 +19,11 @@\n $item_name     = $conn->real_escape_string($values[2]);\r\n $qty           = $conn->real_escape_string($values[3]);   // <-- รับเป็น string\r\n $price         = $conn->real_escape_string($values[4]);   // <-- รับเป็น string\r\n $unit          = $conn->real_escape_string($values[5]);\r\n-$total         = $conn->real_escape_string($values[6]);   // <-- รับเป็น string\r\n+$total = $conn->real_escape_string($values[6]); // เก็บเป็น string\r\n \r\n+\r\n // อัปเดตตาราง delivery_items\r\n $sql = \"UPDATE delivery_items \r\n         SET item_name='$item_name', qty='$qty', price='$price', unit='$unit', total='$total'\r\n         WHERE id=$id\";\r\n"
                }
            ],
            "date": 1758604445389,
            "name": "Commit-0",
            "content": "<?php\r\n$host = \"localhost\";\r\n$user = \"root\";\r\n$pass = \"\";\r\n$dbname = \"shop_it\";\r\n\r\n$conn = new mysqli($host, $user, $pass, $dbname);\r\nif ($conn->connect_error) {\r\n    die(json_encode([\"success\" => false, \"message\" => \"เชื่อมต่อฐานข้อมูลล้มเหลว\"]));\r\n}\r\n\r\n$data = json_decode(file_get_contents(\"php://input\"), true);\r\n$id = intval($data['id']);\r\n$values = $data['data'];\r\n\r\n// data[] = [customer_name, delivery_no, item_name, qty, price, unit, total]\r\n$customer_name = $conn->real_escape_string($values[0]);\r\n$delivery_no   = $conn->real_escape_string($values[1]);\r\n$item_name     = $conn->real_escape_string($values[2]);\r\n$qty           = floatval($values[3]);\r\n$price         = floatval($values[4]);\r\n$unit          = $conn->real_escape_string($values[5]);\r\n$total         = floatval($values[6]);\r\n\r\n// อัปเดตตาราง delivery_items\r\n$sql = \"UPDATE delivery_items \r\n        SET item_name='$item_name', qty=$qty, price=$price, unit='$unit', total=$total\r\n        WHERE id=$id\";\r\n\r\n// อัปเดตชื่อลูกค้าและเลขที่ในตาราง deliveries (หากจำเป็น)\r\n$sql2 = \"UPDATE deliveries d\r\n         JOIN delivery_items i ON i.delivery_id = d.id\r\n         SET d.customer_name='$customer_name', d.delivery_no='$delivery_no'\r\n         WHERE i.id=$id\";\r\n\r\nif ($conn->query($sql) && $conn->query($sql2)) {\r\n    echo json_encode([\"success\" => true]);\r\n} else {\r\n    echo json_encode([\"success\" => false, \"message\" => $conn->error]);\r\n}\r\n$conn->close();\r\n"
        }
    ]
}